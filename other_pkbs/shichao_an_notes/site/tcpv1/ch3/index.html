<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Global Site Tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-59055167-2"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-59055167-2');
        </script>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/tcpv1/ch3/">
        <link rel="shortcut icon" href="../../toki_32.png">
        

	<title>Chapter 3. Link Layer - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,400italic,500,600" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">
        <link href="../../friendly.css" rel="stylesheet">
        <link href="../../theme.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../apue/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch3/">Chapter 3. File I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch4/">Chapter 4. Files and Directories</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch5/">Chapter 5. Standard I/O Library</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch6/">Chapter 6. System Data Files and Information</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch7/">Chapter 7. Process Environment</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch8/">Chapter 8. Process Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch9/">Chapter 9. Process Relationships</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch10/">Chapter 10. Signals</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch11/">Chapter 11. Threads</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch12/">Chapter 12. Thread Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch13/">Chapter 13. Daemon Processes</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch14/">Chapter 14. Advanced I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch15/">Chapter 15. Interprocess Communication</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch16/">Chapter 16. Network IPC: Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch17/">Chapter 17. Advanced IPC</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../unp/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch3/">Chapter 3. Sockets Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch4/">Chapter 4. Elementary TCP Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch5/">Chapter 5. TCP Client/Server Example</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch6/">Chapter 6. I/O Multiplexing: The select and poll Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch7/">Chapter 7. Socket Options</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch8/">Chapter 8. Elementary UDP Sockets</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TCPv1 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../ch2/">Chapter 2. The Internet Address Architecture</a>
                        </li>
                      
                        <li class="active">
                            <a href="./">Chapter 3. Link Layer</a>
                        </li>
                      
                        <li>
                            <a href="../ch4/">Chapter 4. ARP: Address Resolution Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../ch5/">Chapter 5. The Internet Protocol (IP)</a>
                        </li>
                      
                        <li>
                            <a href="../ch6/">Chapter 6. System Configuration: DHCP and Autoconfiguration</a>
                        </li>
                      
                        <li>
                            <a href="../ch7/">Chapter 7. Firewalls and Network Address Translation (NAT)</a>
                        </li>
                      
                        <li>
                            <a href="../ch8/">Chapter 8. ICMPv4 and ICMPv6: Internet Control Message Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../ch9/">Chapter 9. Broadcasting and Local Multicasting (IGMP and MLD)</a>
                        </li>
                      
                        <li>
                            <a href="../ch10/">Chapter 10. User Datagram Protocol (UDP) and IP Fragmentation</a>
                        </li>
                      
                        <li>
                            <a href="../ch11/">Chapter 11. Name Resolution and the Domain Name System (DNS)</a>
                        </li>
                      
                        <li>
                            <a href="../ch12/">Chapter 12. TCP: The Transmission Control Protocol (Preliminaries)</a>
                        </li>
                      
                        <li>
                            <a href="../ch13/">Chapter 13. TCP Connection Management</a>
                        </li>
                      
                        <li>
                            <a href="../ch14/">Chapter 14. TCP Timeout and Retransmission</a>
                        </li>
                      
                        <li>
                            <a href="../ch15/">Chapter 15. TCP Data Flow and Window Management</a>
                        </li>
                      
                        <li>
                            <a href="../ch16/">Chapter 16. TCP Congestion Control</a>
                        </li>
                      
                        <li>
                            <a href="../ch17/">Chapter 17. TCP Keepalive</a>
                        </li>
                      
                        <li>
                            <a href="../ch18/">Chapter 18. Security: EAP, IPsec, TLS, DNSSEC, and DKIM</a>
                        </li>
                      
                        <li>
                            <a href="../headers/">Headers</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">GOPL <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../gopl/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch1/">Chapter 1. Tutorial</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch2/">Chapter 2. Program Structure</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch3/">Chapter 3. Basic Data Types</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch4/">Chapter 4. Composite Types</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch5/">Chapter 5. Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch6/">Chapter 6. Methods</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch7/">Chapter 7. Interfaces</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch8/">Chapter 8. Goroutines and Channels</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch9/">Chapter 9. Concurrency with Shared Variables</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch10/">Chapter 10. Packages and the Go Tool</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch11/">Chapter 11. Testing</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch12/">Chapter 12. Reflection</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CSN <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../csn/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part1/">Part 1: Language</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part2/">Part 2: Advanced</a>
                        </li>
                      
                    </ul>
                </li>
            <li>
                    <a href="../../toc/">TOC</a>
                </li>
            </ul>
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    
                        <a href="https://github.com/shichao-an/notes/blob/master/docs/tcpv1/ch3.md">
                    
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-3-link-layer">Chapter 3. Link Layer</a></li>
        
    
        <li class="main "><a href="#introduction">Introduction</a></li>
        
    
        <li class="main "><a href="#ethernet-and-the-ieee-802-lanman-standards">Ethernet and the IEEE 802 LAN/MAN Standards</a></li>
        
            <li><a href="#the-ieee-802-lanman-standards">The IEEE 802 LAN/MAN Standards</a></li>
        
            <li><a href="#the-ethernet-frame-format">The Ethernet Frame Format</a></li>
        
    
        <li class="main "><a href="#full-duplex-power-save-autonegotiation-and-8021x-flow-control">Full Duplex, Power Save, Autonegotiation, and 802.1X Flow Control</a></li>
        
    
        <li class="main "><a href="#bridges-and-switches">Bridges and Switches</a></li>
        
    
        <li class="main "><a href="#wireless-lansieee-80211wi-fi">Wireless LANs—IEEE 802.11(Wi-Fi)</a></li>
        
    
        <li class="main "><a href="#point-to-point-protocol-ppp">Point-to-Point Protocol (PPP)</a></li>
        
    
        <li class="main "><a href="#loopback">Loopback</a></li>
        
    
        <li class="main "><a href="#mtu-and-path-mtu">MTU and Path MTU</a></li>
        
    
        <li class="main "><a href="#doubts-and-solutions">Doubts and Solutions</a></li>
        
            <li><a href="#verbatim">Verbatim</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
              

<h3 id="chapter-3-link-layer"><strong>Chapter 3. Link Layer</strong><a class="headerlink" href="#chapter-3-link-layer" title="Permanent link">&para;</a></h3>
<h3 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h3>
<p>This chapter discusses the details involved in using the Ethernet and Wi-Fi link layers, how the Point-to-Point Protocol (PPP) is used, and how link-layer protocols can be carried inside other (link- or higher-layer) protocols, a technique known as tunneling.</p>
<p>When referring to link-layer protocol data units (PDUs), we usually use the term <strong>frame</strong>, so as to distinguish the PDU format from those at higher layers such as packets or segments, terms used to describe network- and transport-layer PDUs, respectively.</p>
<p>Frame formats usually support a variable-length frame size, the upper bound of which is called the <a href="https://en.wikipedia.org/wiki/Maximum_transmission_unit"><strong>maximum transmission unit</strong></a> (MTU). Some network technologies, such as modems and serial lines, do not impose their own maximum frame size, so they can be configured by the user.</p>
<h3 id="ethernet-and-the-ieee-802-lanman-standards">Ethernet and the IEEE 802 LAN/MAN Standards<a class="headerlink" href="#ethernet-and-the-ieee-802-lanman-standards" title="Permanent link">&para;</a></h3>
<p>[p80]</p>
<h4 id="the-ieee-802-lanman-standards">The IEEE 802 LAN/MAN Standards<a class="headerlink" href="#the-ieee-802-lanman-standards" title="Permanent link">&para;</a></h4>
<p>[p82]</p>
<h4 id="the-ethernet-frame-format">The Ethernet Frame Format<a class="headerlink" href="#the-ethernet-frame-format" title="Permanent link">&para;</a></h4>
<p>The figure below shows the current layout of an Ethernet frame and how it relates to a relatively new term introduced by IEEE, the <strong>IEEE packet</strong>.</p>
<p><a href="../figure_3-3.png" title="The Ethernet (IEEE 802.3) frame format contains source and destination addresses, an overloaded Length/Type field, a field for data, and a frame check sequence (a CRC32). Additions to the basic frame format provide for a tag containing a VLAN ID and priority information (802.1p/q) and more recently for an extensible number of tags. The preamble and SFD are used for synchronizing receivers. When half-duplex operation is used with Ethernet running at 100Mb/s or more, additional bits may be appended to short frames as a carrier extension to ensure that the collision detection circuitry operates properly. "><img alt="The Ethernet (IEEE 802.3) frame format contains source and destination addresses, an overloaded Length/Type field, a field for data, and a frame check sequence (a CRC32). Additions to the basic frame format provide for a tag containing a VLAN ID and priority information (802.1p/q) and more recently for an extensible number of tags. The preamble and SFD are used for synchronizing receivers. When half-duplex operation is used with Ethernet running at 100Mb/s or more, additional bits may be appended to short frames as a carrier extension to ensure that the collision detection circuitry operates properly. " src="../figure_3-3_600.png" /></a></p>
<ul>
<li>The Ethernet frame begins with a <strong>Preamble</strong> area used by the receiving interface’s circuitry to determine when a frame is arriving and to determine the amount of time between encoded bits (called <strong>clock recovery</strong>). Because Ethernet is an asynchronous LAN, the space between encoded bits may differ from one interface card from another.</li>
<li>
<p>This basic frame format includes 48-bit (6-byte) <strong>Destination</strong> (DST) and <strong>Source</strong> (SRC) Address fields. These addresses are sometimes known by other names such as:</p>
<ul>
<li>MAC address</li>
<li>Link-layer address</li>
<li>802 address</li>
<li>Hardware address</li>
<li>Physical address</li>
</ul>
<p>The destination address in an Ethernet frame is also allowed to address more than one station ("broadcast" or "multicast"; see <a href="../ch9/">Chapter 9</a>). The broadcast capability is used by the ARP protocol (<a href="../ch4/">Chapter 4</a>) and multicast capability is used by the ICMPv6 protocol (<a href="../ch8/">Chapter 8</a>) to convert between network-layer and link-layer addresses.</p>
</li>
<li>
<p><strong>Type</strong> field that doubles as a <strong>Length</strong> field. It identifies the type of data that follows the header. Popular values used with TCP/IP networks include:</p>
<ul>
<li>IPv4 (0x0800)</li>
<li>IPv6 (0x86DD)</li>
<li>ARP (0x0806).</li>
</ul>
<p>The value 0x8100 indicates a Q-tagged frame (i.e., one that can carry a "virtual LAN" or VLAN ID according to the 802.1q standard).</p>
<p><u>The size of a basic Ethernet frame is 1518 bytes</u>, but the more recent standard extended this size to 2000 bytes.</p>
</li>
</ul>
<h3 id="full-duplex-power-save-autonegotiation-and-8021x-flow-control">Full Duplex, Power Save, Autonegotiation, and 802.1X Flow Control<a class="headerlink" href="#full-duplex-power-save-autonegotiation-and-8021x-flow-control" title="Permanent link">&para;</a></h3>
<h3 id="bridges-and-switches">Bridges and Switches<a class="headerlink" href="#bridges-and-switches" title="Permanent link">&para;</a></h3>
<h3 id="wireless-lansieee-80211wi-fi">Wireless LANs—IEEE 802.11(Wi-Fi)<a class="headerlink" href="#wireless-lansieee-80211wi-fi" title="Permanent link">&para;</a></h3>
<h3 id="point-to-point-protocol-ppp">Point-to-Point Protocol (PPP)<a class="headerlink" href="#point-to-point-protocol-ppp" title="Permanent link">&para;</a></h3>
<h3 id="loopback">Loopback<a class="headerlink" href="#loopback" title="Permanent link">&para;</a></h3>
<p>In many cases clients want to communicate with servers on the same computer using Internet protocols such as TCP/IP. To enable this, most implementations support a network-layer <a href="https://en.wikipedia.org/wiki/Loopback"><strong>loopback</strong></a> capability that typically takes the form of a <a href="https://en.wikipedia.org/wiki/Localhost">virtual loopback network interface</a>. <u>It acts like a real network interface but is really a special piece of software provided by the operating system to enable TCP/IP and other communications on the same host computer.</u></p>
<p>IPv4 addresses starting with 127 are reserved for this, as is the IPv6 address ::1 (<a href="../ch2/">Chapter 2</a>). Traditionally, UNIX-like systems including Linux assign the IPv4 address of 127.0.0.1 (::1 for IPv6) to the loopback interface and assign it the name localhost.</p>
<p><u>An IP datagram sent to the loopback interface must not appear on any network.</u> Although we could imagine the transport layer detecting that the other end is a loopback address and shortcircuiting some of the transport-layer logic and all of the network-layer logic, most implementations perform complete processing of the data in the transport layer and network layer and loop the IP datagram back up in the network stack only when the datagram leaves the bottom of the network layer. This can be useful for performance measurement, for example, because the amount of time required to execute the stack software can be measured without any hardware overheads. In Linux, the loopback interface is called <code>lo</code>.</p>
<div class="codehilite"><pre>Linux% ifconfig lo
lo Link encap:Local Loopback
 inet addr:127.0.0.1 Mask:255.0.0.0
 inet6 addr: ::1/128 Scope:Host
 UP LOOPBACK RUNNING MTU:16436 Metric:1
 RX packets:458511 errors:0 dropped:0 overruns:0 frame:0
 TX packets:458511 errors:0 dropped:0 overruns:0 carrier:0
 collisions:0 txqueuelen:0
 RX bytes:266049199 (253.7 MiB)
 TX bytes:266049199 (253.7 MiB)
</pre></div>


<p>This local loopback interface:</p>
<ul>
<li>The IPv4 address is 127.0.0.1 and has a subnet mask of 255.0.0.0 (corresponding to class A network number 127 in classful addressing).</li>
<li>The IPv6 address ::1 has a 128-bit-long prefix, so it represents only a single address. The interface has an MTU of 16KB (this can be configured to a much larger size, up to 2GB).</li>
</ul>
<p>We would not expect to see errors on the local loopback device, given that it never really sends packets on any network</p>
<h3 id="mtu-and-path-mtu">MTU and Path MTU<a class="headerlink" href="#mtu-and-path-mtu" title="Permanent link">&para;</a></h3>
<p>From <a href="../figure_3-3.png">Figure 3-3</a>, there is a limit on the frame's size available for carrying the PDUs of higher-layer protocols in link-layer networks. This usually limits the number of payload bytes to about 1500 for Ethernet and often the same amount for PPP in order to maintain compatibility with Ethernet.</p>
<p>This characteristic (the limit of frame's size to carry higher-layer PDUs) of the link layer is called the <strong>maximum transmission unit</strong> (MTU). Most packet networks (like Ethernet) have a fixed upper limit:</p>
<ul>
<li>Most stream-type networks (serial links) have a configurable limit that is then used by framing protocols such as PPP.</li>
<li>If IP has a datagram to send, and the datagram is larger than the link layer’s MTU, IP performs <em>fragmentation</em>, breaking the datagram up into smaller pieces (fragments), so that each fragment is smaller than the MTU.</li>
</ul>
<p>MTU on networks:</p>
<ul>
<li>When two hosts on the same network are communicating with each other, it is the MTU of the local link interconnecting them that has a direct effect on the size of datagrams.</li>
<li>When two hosts communicate across multiple networks, each link can have a different MTU. The minimum MTU across the network path comprising all of the links is called the <strong>path MTU</strong>.</li>
</ul>
<p>The path MTU between any two hosts need not be constant over time:</p>
<ul>
<li>It depends on the path being used at any time, which can change if the routers or links in the network fail;</li>
<li>Paths are often not <em>symmetric</em> (the path from host A to B may not be the reverse of the path from B to A); hence the path MTU need not be the same in the two directions.</li>
</ul>
<p><a href="https://en.wikipedia.org/wiki/Path_MTU_Discovery"><strong>Path MTU discovery</strong></a> (PMTUD) is used to determine the path MTU at a point in time (and is required of IPv6 implementations).</p>
<h3 id="doubts-and-solutions">Doubts and Solutions<a class="headerlink" href="#doubts-and-solutions" title="Permanent link">&para;</a></h3>
<h4 id="verbatim">Verbatim<a class="headerlink" href="#verbatim" title="Permanent link">&para;</a></h4>
<p>p146 on loopback</p>
<blockquote>
<p>An IP datagram sent to the loopback interface must not appear on any network. Although we could imagine the transport layer detecting that the other end is a loopback address and shortcircuiting some of the transport-layer logic and all of the network-layer logic, most implementations perform complete processing of the data in the transport layer and network layer and loop the IP datagram back up in the network stack only when the datagram leaves the bottom of the network layer.</p>
</blockquote>
            </div>
        </div>

        <footer class="col-md-12">
            
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../custom.js"></script>
    </body>
</html>