<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Global Site Tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-59055167-2"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-59055167-2');
        </script>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/gopl/ch10/">
        <link rel="shortcut icon" href="../../toki_32.png">
        

	<title>Chapter 10. Packages and the Go Tool - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,400italic,500,600" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">
        <link href="../../friendly.css" rel="stylesheet">
        <link href="../../theme.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../apue/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch3/">Chapter 3. File I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch4/">Chapter 4. Files and Directories</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch5/">Chapter 5. Standard I/O Library</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch6/">Chapter 6. System Data Files and Information</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch7/">Chapter 7. Process Environment</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch8/">Chapter 8. Process Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch9/">Chapter 9. Process Relationships</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch10/">Chapter 10. Signals</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch11/">Chapter 11. Threads</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch12/">Chapter 12. Thread Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch13/">Chapter 13. Daemon Processes</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch14/">Chapter 14. Advanced I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch15/">Chapter 15. Interprocess Communication</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch16/">Chapter 16. Network IPC: Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch17/">Chapter 17. Advanced IPC</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../unp/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch3/">Chapter 3. Sockets Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch4/">Chapter 4. Elementary TCP Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch5/">Chapter 5. TCP Client/Server Example</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch6/">Chapter 6. I/O Multiplexing: The select and poll Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch7/">Chapter 7. Socket Options</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch8/">Chapter 8. Elementary UDP Sockets</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TCPv1 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../tcpv1/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch2/">Chapter 2. The Internet Address Architecture</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch3/">Chapter 3. Link Layer</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch4/">Chapter 4. ARP: Address Resolution Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch5/">Chapter 5. The Internet Protocol (IP)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch6/">Chapter 6. System Configuration: DHCP and Autoconfiguration</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch7/">Chapter 7. Firewalls and Network Address Translation (NAT)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch8/">Chapter 8. ICMPv4 and ICMPv6: Internet Control Message Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch9/">Chapter 9. Broadcasting and Local Multicasting (IGMP and MLD)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch10/">Chapter 10. User Datagram Protocol (UDP) and IP Fragmentation</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch11/">Chapter 11. Name Resolution and the Domain Name System (DNS)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch12/">Chapter 12. TCP: The Transmission Control Protocol (Preliminaries)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch13/">Chapter 13. TCP Connection Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch14/">Chapter 14. TCP Timeout and Retransmission</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch15/">Chapter 15. TCP Data Flow and Window Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch16/">Chapter 16. TCP Congestion Control</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch17/">Chapter 17. TCP Keepalive</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch18/">Chapter 18. Security: EAP, IPsec, TLS, DNSSEC, and DKIM</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/headers/">Headers</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">GOPL <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../ch1/">Chapter 1. Tutorial</a>
                        </li>
                      
                        <li>
                            <a href="../ch2/">Chapter 2. Program Structure</a>
                        </li>
                      
                        <li>
                            <a href="../ch3/">Chapter 3. Basic Data Types</a>
                        </li>
                      
                        <li>
                            <a href="../ch4/">Chapter 4. Composite Types</a>
                        </li>
                      
                        <li>
                            <a href="../ch5/">Chapter 5. Functions</a>
                        </li>
                      
                        <li>
                            <a href="../ch6/">Chapter 6. Methods</a>
                        </li>
                      
                        <li>
                            <a href="../ch7/">Chapter 7. Interfaces</a>
                        </li>
                      
                        <li>
                            <a href="../ch8/">Chapter 8. Goroutines and Channels</a>
                        </li>
                      
                        <li>
                            <a href="../ch9/">Chapter 9. Concurrency with Shared Variables</a>
                        </li>
                      
                        <li class="active">
                            <a href="./">Chapter 10. Packages and the Go Tool</a>
                        </li>
                      
                        <li>
                            <a href="../ch11/">Chapter 11. Testing</a>
                        </li>
                      
                        <li>
                            <a href="../ch12/">Chapter 12. Reflection</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CSN <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../csn/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part1/">Part 1: Language</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part2/">Part 2: Advanced</a>
                        </li>
                      
                    </ul>
                </li>
            <li>
                    <a href="../../toc/">TOC</a>
                </li>
            </ul>
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    
                        <a href="https://github.com/shichao-an/notes/blob/master/docs/gopl/ch10.md">
                    
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-10-packages-and-the-go-tool">Chapter 10. Packages and the Go Tool</a></li>
        
    
        <li class="main "><a href="#introduction">Introduction</a></li>
        
    
        <li class="main "><a href="#import-paths">Import Paths</a></li>
        
    
        <li class="main "><a href="#the-package-declaration">The Package Declaration</a></li>
        
            <li><a href="#the-last-segment-convention">The "Last Segment" Convention *</a></li>
        
    
        <li class="main "><a href="#import-declarations">Import Declarations</a></li>
        
    
        <li class="main "><a href="#blank-imports">Blank Imports</a></li>
        
    
        <li class="main "><a href="#packages-and-naming">Packages and Naming</a></li>
        
    
        <li class="main "><a href="#the-go-tool">The Go Tool</a></li>
        
            <li><a href="#workspace-organization">Workspace Organization</a></li>
        
            <li><a href="#downloading-packages">Downloading Packages</a></li>
        
            <li><a href="#building-packages">Building Packages</a></li>
        
            <li><a href="#documenting-packages">Documenting Packages</a></li>
        
            <li><a href="#internal-packages">Internal Packages</a></li>
        
            <li><a href="#querying-packages">Querying Packages</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
              

<h3 id="chapter-10-packages-and-the-go-tool"><strong>Chapter 10. Packages and the Go Tool</strong><a class="headerlink" href="#chapter-10-packages-and-the-go-tool" title="Permanent link">&para;</a></h3>
<p>In a program, the majority of the functions were written by others and made available for reuse through <strong>packages</strong>.</p>
<p>Go has over 100 standard packages that provide the foundations for most applications.  The Go community has published many more, and you can find a searchable index of them at <a href="https://godoc.org/">https://godoc.org</a>. This chapter discusses how to use existing packages and create new ones.</p>
<p>Go also comes with the <code>go</code> tool, a sophisticated but simple-to-use command for managing workspaces of Go packages. Since the beginning of the book, we’ve been showing how to use the <code>go</code> tool to download, build, and run example programs. This chapter studies the tools' underlying concepts and its capabilities, which include printing documentation and querying metadata about the packages in the workspace.</p>
<h3 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h3>
<p>The purpose of any package system is to make the design and maintenance of large programs practical by grouping related features together into units that can be easily understood and changed, independent of the other packages of the program.</p>
<p>This <a href="https://en.wikipedia.org/wiki/Modular_programming"><em>modularity</em></a> allows packages to be:</p>
<ul>
<li>Shared and reused by different projects,</li>
<li>Distributed within an organization, or,</li>
<li>Made available to the wider world.</li>
</ul>
<p>Each package defines a distinct name space that encloses its identifiers. Each name is associated with a particular package, so we can choose short, clear names for the types, functions, etc. that we use most often, without creating conflicts with other parts of the program.</p>
<p>Packages also provide <a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)"><em>encapsulation</em></a> by controlling which names are visible or exported outside the package. Restricting the visibility of package members has two advantages:</p>
<ul>
<li>It hides the helper functions and types behind the package's API, allowing the package maintainer to change the implementation without affecting code outside the package.</li>
<li>It hides variables so that clients can access and update them only through exported functions that preserve internal invariants or enforce mutual exclusion in a concurrent program.</li>
</ul>
<p>When we change a file, we must recompile the file's package and potentially all the packages that depend on it. Go compilation is notably faster than most other compiled languages, even when building from scratch. There are three main reasons for the compiler's speed.</p>
<ol>
<li>All imports must be explicitly listed at the beginning of each source file, so the compiler does not have to read and process an entire file to determine its dependencies.</li>
<li>The dependencies of a package form a directed acyclic graph, and because there are no cycles, packages can
be compiled separately and perhaps in parallel.</li>
<li>The object file for a compiled Go package records export information not just for the package itself, but also for its dependencies. When compiling a package, the compiler must read one object file for each import but need
not look beyond these files.</li>
</ol>
<h3 id="import-paths">Import Paths<a class="headerlink" href="#import-paths" title="Permanent link">&para;</a></h3>
<p>Each package is identified by a unique string called its <a href="https://golang.org/doc/code.html#ImportPaths"><em>import path</em></a>. Import paths are the strings that appear in <code>import</code> declarations.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;encoding/json&quot;</span>
    <span class="s">&quot;golang.org/x/net/html&quot;</span>
    <span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<span class="p">)</span>
</pre></div>


<p>As mentioned in <a href="../ch2/#imports">Section 2.6.1</a>, the Go language specification doesn't define the meaning of these strings or how to determine a packages' import path, but leaves these issues to the tools.  This chapter discusses how the <code>go</code> tool interprets them, which is what the majority of Go programmers use for building, testing, and so on. However, other tools do exist. For example, Go programmers using Google's internal multi-language build system follow different rules for naming and locating packages, specifying tests, and so on, that more closely match the conventions of that system.</p>
<p>For packages you intend to share or publish, import paths should be globally unique. To avoid conflicts, the import paths of all packages other than those from the standard library should start with the Internet domain name of the organization that owns or hosts the package; this also makes it possible to find packages.</p>
<h3 id="the-package-declaration">The Package Declaration<a class="headerlink" href="#the-package-declaration" title="Permanent link">&para;</a></h3>
<p>A package declaration is required at the start of every Go source file. Its main purpose is to determine the default identifier for that package (called the <em>package name</em>) when it is imported by another package.</p>
<p>For example, every file of the <code>math/rand</code> package starts with package <code>rand</code>, so when you import this package, you can access its members as <code>rand.Int</code>, <code>rand.Float64</code>, and so on.</p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Int</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>


<h4 id="the-last-segment-convention">The "Last Segment" Convention *<a class="headerlink" href="#the-last-segment-convention" title="Permanent link">&para;</a></h4>
<p>Conventionally, the package name is the last segment of the import path, and as a result, two packages may have the same name even though their import paths differ. For example, the packages whose import paths are <code>math/rand</code> and <code>crypto/rand</code> both have the name <code>rand</code>. How to use both in the same program will be discussed in a moment.</p>
<p>There are three major exceptions to the "last segment" convention.</p>
<ol>
<li>A package defining a command (an executable Go program) always has the name <code>main</code>, regardless of the packages' import path. This is a signal to <code>go build</code> (<a href="./#building-packages">Section 10.7.3</a>) that it must invoke the linker to make an executable file.</li>
<li>Some files in the directory may have the suffix <code>_test</code> on their package name if the file name ends with <code>_test.go</code>. Such a directory may define two packages: the usual one, plus another one called an <em>external test package</em>. The <code>_test</code> suffix signals to <code>go test</code> that it must build both packages, and it indicates which files belong to each package. External test packages are used to avoid cycles in the import graph arising from dependencies of the test; they are covered in more detail in <a href="../ch11/#external-test-packages">Section 11.2.4</a>.</li>
<li>Some tools for dependency management append version number suffixes to package import paths, such as <code>"gopkg.in/yaml.v2"</code>. The package name excludes the suffix, so in this case it would be just <code>yaml</code>.</li>
</ol>
<h3 id="import-declarations">Import Declarations<a class="headerlink" href="#import-declarations" title="Permanent link">&para;</a></h3>
<p>A Go source file may contain zero or more import declarations immediately after the package declaration and before the first non-import declaration. Each import declaration may specify the import path of a single package, or multiple packages in a parenthesized list. The two forms below are equivalent but the second form is more common.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>
<span class="kn">import</span> <span class="s">&quot;os&quot;</span>
</pre></div>


<div class="codehilite"><pre><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>
</pre></div>


<p>Imported packages may be grouped by introducing blank lines; such groupings usually indicate different domains. The order is not significant, but by convention the lines of each group are sorted alphabetically. (Both <code>gofmt</code> and <a href="https://godoc.org/golang.org/x/tools/cmd/goimports"><code>goimports</code></a> will group and sort for you.)</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;html/template&quot;</span>
    <span class="s">&quot;os&quot;</span>

    <span class="s">&quot;golang.org/x/net/html&quot;</span>
    <span class="s">&quot;golang.org/x/net/ipv4&quot;</span>
<span class="p">)</span>
</pre></div>


<p>If you need to import two packages whose names are the same, like <code>math/rand</code> and <code>crypto/rand</code>, into a third package, the import declaration must specify an alternative name for at least one of them to avoid a conflict. This is called a <em>renaming import</em>.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;crypto/rand&quot;</span>
    <span class="nx">mrand</span> <span class="s">&quot;math/rand&quot;</span> <span class="c1">// alternative name mrand avoids conflict</span>
<span class="p">)</span>
</pre></div>


<p>The alternative name affects only the importing file, not other files (even ones in the same package).</p>
<p>A renaming import may be useful even when there is no conflict:</p>
<ul>
<li>If the name of the imported package is unwieldy, as is sometimes the case for automatically generated code, an abbreviated name may be more convenient. The same short name should be used consistently to avoid confusion.</li>
<li>Choosing an alternative name can help avoid conflicts with common local variable names. For example, in a file with many local variables named <code>path</code>, we might import the standard <code>"path"</code> package as <code>pathpkg</code>.</li>
</ul>
<p>Each import declaration establishes a dependency from the current package to the imported package. The <code>go build</code> tool reports an error if these dependencies form a cycle.</p>
<h3 id="blank-imports">Blank Imports<a class="headerlink" href="#blank-imports" title="Permanent link">&para;</a></h3>
<p>Within a file, it is an error to import a package but not refer to the name it defines.  However, on occasion we must import a package merely for the side effects of doing so: evaluation of the initializer expressions of its package-level variables and execution of its <code>init</code> functions (<a href="../ch2/#package-initialization">Section 2.6.2</a>). To suppress the "unused import" error, we must use a renaming import in which the alternative name is <code>_</code>, the blank identifier, which can never be referenced.</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nx">_</span> <span class="s">&quot;image/png&quot;</span> <span class="c1">// register PNG decoder</span>
</pre></div>


<p>This is known as a <em>blank import</em>. It is most often used to implement a compile-time mechanism whereby the main program can enable optional features by blank-importing additional packages.</p>
<p>As an example, the standard library's <a href="https://golang.org/pkg/image/"><code>image</code></a> package exports a <a href="https://golang.org/pkg/image/#Decode"><code>Decode</code></a> function that reads bytes from an <code>io.Reader</code>, figures out which image format was used to encode the data, invokes the appropriate decoder, then returns the resulting <code>image.Image</code>. Using <code>image.Decode</code>, it's easy to build a simple image converter that reads an image in one format and writes it out in another:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch10/jpeg/main.go">gopl.io/ch10/jpeg/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// The jpeg command reads a PNG image from the standard input</span>
<span class="c1">// and writes it as a JPEG image to the standard output.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;image&quot;</span>
    <span class="s">&quot;image/jpeg&quot;</span>
    <span class="nx">_</span> <span class="s">&quot;image/png&quot;</span> <span class="c1">// register PNG decoder</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">toJPEG</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="s">&quot;jpeg: %v\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">toJPEG</span><span class="p">(</span><span class="nx">in</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">,</span> <span class="nx">out</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">img</span><span class="p">,</span> <span class="nx">kind</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="nx">in</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="s">&quot;Input format =&quot;</span><span class="p">,</span> <span class="nx">kind</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">jpeg</span><span class="p">.</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span> <span class="nx">img</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">jpeg</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span><span class="nx">Quality</span><span class="p">:</span> <span class="mi">95</span><span class="p">})</span>
<span class="p">}</span>
</pre></div>


<p>If we feed the output of <a href="https://github.com/shichao-an/gopl.io/blob/master/ch3/mandelbrot/main.go">gopl.io/ch3/mandelbrot</a> (<a href="../ch3/#complex-numbers">Section 3.3</a>) to the converter program, it detects the PNG input format and writes a JPEG image.</p>
<div class="codehilite"><pre><span class="gp">$</span> go build gopl.io/ch3/mandelbrot
<span class="gp">$</span> go build gopl.io/ch10/jpeg
<span class="gp">$</span> ./mandelbrot <span class="p">|</span> ./jpeg &gt;mandelbrot.jpg
</pre></div>


<p>If without the blank import of <code>image/png</code>, the program compiles and links as usual but can no longer recognize or decode input in PNG format:</p>
<div class="codehilite"><pre><span class="gp">$</span> go build gopl.io/ch10/jpeg
<span class="gp">$</span> ./mandelbrot <span class="p">|</span> ./jpeg &gt;mandelbrot.jpg
<span class="go">jpeg: image: unknown format</span>
</pre></div>


<p>The cause is: the standard library provides decoders for GIF, PNG, and JPEG, and users may provide others, but to keep executables small, decoders are not included in an application unless explicitly requested.</p>
<p>The <code>image.Decode</code> function consults a table of supported formats. Each entry in the table specifies four things:</p>
<ol>
<li>The name of the format</li>
<li>A string that is a prefix of all images encoded this way, used to detect the encoding</li>
<li>A function <code>Decode</code> that decodes an encoded image</li>
<li>Another function <code>DecodeConfig</code> that decodes only the image metadata, such as its size and color space</li>
</ol>
<p>An entry is added to the table by calling <code>image.RegisterFormat</code>, typically from within the package initializer of the supporting package for each format, like this one in <code>image/png</code>:</p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="nx">png</span> <span class="c1">// image/png</span>

<span class="kd">func</span> <span class="nx">Decode</span><span class="p">(</span><span class="nx">r</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span> <span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">Image</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span> <span class="nx">DecodeConfig</span><span class="p">(</span><span class="nx">r</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span> <span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">Config</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

<span class="kd">func</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">pngHeader</span> <span class="p">=</span> <span class="s">&quot;\x89PNG\r\n\x1a\n&quot;</span>
    <span class="nx">image</span><span class="p">.</span><span class="nx">RegisterFormat</span><span class="p">(</span><span class="s">&quot;png&quot;</span><span class="p">,</span> <span class="nx">pngHeader</span><span class="p">,</span> <span class="nx">Decode</span><span class="p">,</span> <span class="nx">DecodeConfig</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>The effect is that an application need only blank-import the package for the format it needs to make the <code>image.Decode</code> function able to decode it.</p>
<p>The database/sql package uses a similar mechanism allowing users install just the database drivers they need. For example:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;database/mysql&quot;</span>
    <span class="nx">_</span> <span class="s">&quot;github.com/lib/pq&quot;</span>              <span class="c1">// enable support for Postgres</span>
    <span class="nx">_</span> <span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span> <span class="c1">// enable support for MySQL</span>
<span class="p">)</span>

<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;postgres&quot;</span><span class="p">,</span> <span class="nx">dbname</span><span class="p">)</span> <span class="c1">// OK</span>
<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span> <span class="nx">dbname</span><span class="p">)</span>    <span class="c1">// OK</span>
<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;sqlite3&quot;</span><span class="p">,</span> <span class="nx">dbname</span><span class="p">)</span>  <span class="c1">// returns error: unknown driver &quot;sqlite3&quot;</span>
</pre></div>


<h3 id="packages-and-naming">Packages and Naming<a class="headerlink" href="#packages-and-naming" title="Permanent link">&para;</a></h3>
<p>This section offers some advice on how to follow Go's distinctive conventions for naming packages and their members.</p>
<p>The package name should be short, but not so short as to be cryptic. The most frequently used packages in the standard library are named <code>bufio</code>, <code>bytes</code>, <code>flag</code>, <code>fmt</code>, <code>http</code>, <code>io</code>, <code>json</code>, <code>os</code>, <code>sort</code>, <code>sync</code>, and <code>time</code>.</p>
<p>Be descriptive and unambiguous where possible. For example, don't name a utility package <code>util</code> when a name such as <code>imageutil</code> or <code>ioutil</code> is specific yet still concise. Avoid choosing package names that are commonly used for related local variables, or you may compel the package's clients to use renaming imports, as with the <code>path</code> package.</p>
<p>Package names usually take the singular form, with some exceptions:</p>
<ul>
<li>The standard packages <code>bytes</code>, <code>errors</code>, and <code>strings</code> use the plural to avoid hiding the corresponding predeclared types.</li>
<li>The standard package <code>go/types</code> use the plural to avoid conflict with a keyword.</li>
</ul>
<p>Avoid package names that already have other connotations. For example, we originally used the name temp for the temperature conversion package in <a href="../ch2/#type-declarations">Section 2.5</a>, but that didn't last long. It was a terrible idea because "temp" is an almost universal synonym for "temporary". We went through a brief period with the name <code>temperature</code>, but that was too long and didn't say what the package did. In the end, it became <code>tempconv</code>, which is shorter and parallel with <code>strconv</code>.</p>
<p>Since each reference to a member of another package uses a qualified identifier such as <code>fmt.Println</code>, the burden of describing the package member is shared equally by the package name and the member name. We need not mention the concept of formatting in <code>Println</code> because the package name <code>fmt</code> does that already. When designing a package, consider how the two parts of a qualified identifier work together, not the member name alone. For example:</p>
<ul>
<li><code>bytes.Equal</code></li>
<li><code>flag.Int</code></li>
<li><code>http.Get</code></li>
<li><code>json.Marshal</code></li>
</ul>
<p>We can identify some common naming patterns. The <code>strings</code> package provides a number of independent functions for manipulating strings:</p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="nx">strings</span>

<span class="kd">func</span> <span class="nx">Index</span><span class="p">(</span><span class="nx">needle</span><span class="p">,</span> <span class="nx">haystack</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span>

<span class="kd">type</span> <span class="nx">Replacer</span> <span class="kd">struct</span><span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="kd">func</span> <span class="nx">NewReplacer</span><span class="p">(</span><span class="nx">oldnew</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Replacer</span>

<span class="kd">type</span> <span class="nx">Reader</span> <span class="kd">struct</span><span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="kd">func</span> <span class="nx">NewReader</span><span class="p">(</span><span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Reader</span>
</pre></div>


<p>The word <code>string</code> does not appear in any of their names. Clients refer to them as <code>strings.Index</code>, <code>strings.Replacer</code>, and so on.</p>
<p>Other packages that we might describe as <em>single-type packages</em>, such as <code>html/template</code> and <code>math/rand</code>, expose one principal data type plus its methods, and often a <code>New</code> function to create instances.</p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="nx">rand</span> <span class="c1">// &quot;math/rand&quot;</span>

<span class="kd">type</span> <span class="nx">Rand</span> <span class="kd">struct</span><span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="kd">func</span> <span class="nx">New</span><span class="p">(</span><span class="nx">source</span> <span class="nx">Source</span><span class="p">)</span> <span class="o">*</span><span class="nx">Rand</span>
</pre></div>


<p>This can lead to repetition, as in <code>template.Template</code> or <code>rand.Rand</code>, which is why the names of these kinds of packages are often especially short.</p>
<p>At the other extreme, there are packages like <code>net/http</code> that have a lot of names without a lot of structure, because they perform a complicated task. Despite having over twenty types and many more functions, the package's most important members have the simplest names: <code>Get</code>, <code>Post</code>, <code>Handle</code>, <code>Error</code>, <code>Client</code>, <code>Server</code>.</p>
<h3 id="the-go-tool">The Go Tool<a class="headerlink" href="#the-go-tool" title="Permanent link">&para;</a></h3>
<p>The rest of this chapter concerns the <a href="https://golang.org/cmd/go/"><code>go</code></a> tool, which is used for downloading, querying, formatting, building, testing, and installing packages of Go code.</p>
<p>The <code>go</code> tool combines the features of a diverse set of tools into one command set:</p>
<ul>
<li>It is a package manager (analogous to <code>apt</code> or <code>rpm</code>) that answers queries about its inventory of packages, computes their dependencies, and downloads them from remote version-control systems.</li>
<li>It is a build system that computes file dependencies and invokes compilers, assemblers, and linkers, although it is intentionally less complete than the standard Unix <a href="https://en.wikipedia.org/wiki/Make_(software)"><code>make</code></a>.</li>
<li>It is a test driver (discussed in <a href="../ch11/">Chapter 11</a>).</li>
</ul>
<p>Its command-line interface uses the "Swiss army knife" style, with over a dozen subcommands, some of which we have already seen, like <code>get</code>, <code>run</code>, <code>build</code>, and <code>fmt</code>. You can run <code>go help</code> to see the index of its built-in documentation. The most commonly used commands are:</p>
<div class="codehilite"><pre>$ go
...
    build     compile packages and dependencies
    clean     remove object files
    doc       show documentation for package or symbol
    env       print Go environment information
    fmt       run gofmt on package sources
    get       download and install packages and dependencies
    install   compile and install packages and dependencies
    list      list packages
    run       compile and run Go program
    test      test packages
    version   print Go version
    vet       run go tool vet on packages
Use &quot;go help [command]&quot; for more information about a command.
...
</pre></div>


<p>To keep the need for configuration to a minimum, the <code>go</code> tool relies heavily on conventions. For example:</p>
<ul>
<li>Given the name of a Go source file, the tool can find its enclosing package, because each directory contains a single package and the import path of a package corresponds to the directory hierarchy in the workspace.</li>
<li>Given the import path of a package, the tool can find the corresponding directory in which it stores object files.</li>
<li>It can also find the URL of the server that hosts the source code repository.</li>
</ul>
<h4 id="workspace-organization">Workspace Organization<a class="headerlink" href="#workspace-organization" title="Permanent link">&para;</a></h4>
<p>The only configuration most users ever need is the <code>GOPATH</code> environment variable, which specifies the root of the workspace. When switching to a different workspace, users update the value of <code>GOPATH</code>. For example:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">export</span> <span class="nv">GOPATH</span><span class="o">=</span>$HOME/gobook
<span class="gp">$</span> go get gopl.io/...
</pre></div>


<p>After you download all the programs for this book using the command above, your workspace will contain a hierarchy like this one:</p>
<div class="codehilite"><pre>GOPATH/
    src/
        gopl.io/
            .git/
            ch1/
                helloworld/
                    main.go
                dup/
                    main.go
                ...
        golang.org/x/net/
            .git/
            html/
                parse.go
                node.go
                ...
    bin/
        helloworld
        dup
    pkg/
        darwin_amd64/
            ...
</pre></div>


<p><code>GOPATH</code> has three subdirectories:</p>
<ul>
<li>The <code>src</code> subdirectory holds source code. Each package resides in a directory whose name relative to <code>$GOPATH/src</code> is the package's import path, such as <code>gopl.io/ch1/helloworld</code>. Observe that a single <code>GOPATH</code> workspace contains multiple version-control repositories beneath <code>src</code>, such as <code>gopl.io</code> or <code>golang.org</code>.</li>
<li>The <code>pkg</code> subdirectory is where the build tools store compiled packages</li>
<li>The <code>bin</code> subdirectory holds executable programs like <code>helloworld</code>.</li>
</ul>
<p>A second environment variable, <code>GOROOT</code>, specifies the root directory of the Go distribution, which provides all the packages of the standard library. The directory structure beneath <code>GOROOT</code> resembles that of <code>GOPATH</code>. For example, the source files of the <code>fmt</code> package reside in the <code>$GOROOT/src/fmt</code> directory. Users never need to set <code>GOROOT</code> since, by default, the <code>go</code> tool will use the location where it was installed.</p>
<p>The <code>go env</code> command prints the effective values of the environment variables relevant to the toolchain, including the default values for the missing ones. <code>GOOS</code> specifies the target operating system (for example, <code>android</code>, <code>linux</code>, <code>darwin</code>, or <code>windows</code>) and <code>GOARCH</code> specifies the target processor architecture, such as <code>amd64</code>, <code>386</code>, or <code>arm</code>. Although <code>GOPATH</code> is the only variable you must set, the others occasionally appear in our explanations.</p>
<div class="codehilite"><pre><span class="gp">$</span> go env
<span class="go">GOPATH=&quot;/home/gopher/gobook&quot;</span>
<span class="go">GOROOT=&quot;/usr/local/go&quot;</span>
<span class="go">GOARCH=&quot;amd64&quot;</span>
<span class="go">GOOS=&quot;darwin&quot;</span>
<span class="go">...</span>
</pre></div>


<h4 id="downloading-packages">Downloading Packages<a class="headerlink" href="#downloading-packages" title="Permanent link">&para;</a></h4>
<p>When using the go tool, a package's import path indicates not only where to find it in the local workspace, but where to find it on the Internet so that <code>go get</code> can retrieve and update it.</p>
<p>The <code>go get</code> command can download a single package or an entire subtree or repository using the <code>...</code> notation, as in the previous section. The tool also computes and downloads all the dependencies of the initial packages, which is why the <code>golang.org/x/net/html</code> package appeared in the workspace in the previous example.</p>
<p>Once <code>go get</code> has downloaded the packages, it builds them and then installs the libraries and commands.</p>
<p>In the following example:</p>
<div class="codehilite"><pre><span class="gp">$</span> go get github.com/golang/lint/golint
<span class="gp">$</span> $GOPATH/bin/golint gopl.io/ch2/popcount
<span class="go">src/gopl.io/ch2/popcount/main.go:1:1:</span>
<span class="go">  package comment should be of the form &quot;Package popcount ...&quot;</span>
</pre></div>


<ul>
<li>The first command gets the <code>golint</code> tool, which checks for common style problems in Go source code.</li>
<li>The second command runs <code>golint</code> on <code>gopl.io/ch2/popcount</code> from <a href="../ch2/#package-initialization">Section 2.6.2</a>. It helpfully reports that we have forgotten to write a doc comment for the package.</li>
</ul>
<p>The <code>go get</code> command has support for popular code-hosting sites like <a href="https://github.com/">GitHub</a>, <a href="https://bitbucket.org/">Bitbucket</a>, and <a href="https://launchpad.net/">Launchpad</a> and can make the appropriate requests to their version-control systems. For less well-known sites, you may have to indicate which version-control protocol to use in the import path, such as Git or Mercurial. Run <a href="https://golang.org/cmd/go/#hdr-Import_path_syntax"><code>go help importpath</code></a> for the details.</p>
<p>The directories that <code>go get</code> creates are true clients of the remote repository, not just copies of the files, so you can use version-control commands to see a diff of local edits you've made or to update to a different revision. For example, the <code>golang.org/x/net</code> directory is a Git client:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">cd</span> $GOPATH/src/golang.org/x/net
<span class="gp">$</span> git remote -v
<span class="go">origin https://go.googlesource.com/net (fetch)</span>
<span class="go">origin https://go.googlesource.com/net (push)</span>
</pre></div>


<p>Notice that the apparent domain name in the package's import path, <code>golang.org</code>, differs from the actual domain name of the Git server, <code>go.googlesource.com</code>. This is a feature of the <code>go</code> tool that lets packages use a custom domain name in their import path while being hosted by a generic service such as <code>googlesource.com</code> or <code>github.com</code>. HTML pages beneath <a href="https://golang.org/x/net/html">https://golang.org/x/net/html</a> include the metadata shown below, which redirects the go tool to the Git repository at the actual hosting site:</p>
<div class="codehilite"><pre><span class="gp">$</span> go build gopl.io/ch1/fetch
<span class="gp">$</span> ./fetch https://golang.org/x/net/html <span class="p">|</span> grep go-import
<span class="go">&lt;meta name=&quot;go-import&quot;</span>
<span class="go">      content=&quot;golang.org/x/net git https://go.googlesource.com/net&quot;&gt;</span>
</pre></div>


<p>If you specify the <code>-u</code> flag, <code>go get</code> will ensure that all packages it visits, including dependencies, are updated to their latest version before being built and installed. Without that flag, packages that already exist locally will not be updated.</p>
<h5 id="vendor-directories"><strong>Vendor Directories</strong> *<a class="headerlink" href="#vendor-directories" title="Permanent link">&para;</a></h5>
<p>The <code>go get -u</code> command generally retrieves the latest version of each package, which is convenient when you're getting started but may be inappropriate for deployed projects, where precise control of dependencies is critical for release hygiene. The usual solution to this problem is to <em>vendor</em> the code, that is, to make a persistent local copy of all the necessary dependencies, and to update this copy carefully and deliberately. Prior to Go 1.5, this required changing those packages' import paths, so our copy of <code>golang.org/x/net/html</code> would become <code>gopl.io/vendor/golang.org/x/net/html</code>. More recent versions of the <code>go tool</code> support vendoring directly. See <a href="https://golang.org/cmd/go/#hdr-Vendor_Directories"><em>Vendor Directories</em></a> in the output of the <code>go help gopath</code> command.</p>
<h4 id="building-packages">Building Packages<a class="headerlink" href="#building-packages" title="Permanent link">&para;</a></h4>
<p>The <code>go build</code> command compiles each argument package.</p>
<ul>
<li><u>If the package is a library, the result is discarded;</u> this merely checks that the package is free of compile errors.</li>
<li>If the package is named <code>main</code>, <code>go build</code> invokes the linker to create an executable in the current directory; the name of the executable is taken from the last segment of the package's import path.</li>
</ul>
<p>Since each directory contains one package, each executable program, or <em>command</em> in Unix terminology, requires its own directory. These directories are sometimes children of a directory named <code>cmd</code>, such as the <a href="https://godoc.org/golang.org/x/tools/cmd/godoc"><code>golang.org/x/tools/cmd/godoc</code></a> command which serves Go package documentation through a web interface (<a href="#documenting-packages">Section 10.7.4</a>).</p>
<p>Packages may be specified by their import paths, or by a relative directory name, which must start with a <code>.</code> or <code>..</code> segment even if this would not ordinarily be required. If no argument is provided, the current directory is assumed. Thus the following commands build the same package, though each writes the executable to the directory in which <code>go build</code> is run:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">cd</span> $GOPATH/src/gopl.io/ch1/helloworld
<span class="gp">$</span> go build
</pre></div>


<p>and:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">cd</span> anywhere
<span class="gp">$</span> go build gopl.io/ch1/helloworld
</pre></div>


<p>and:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">cd</span> $GOPATH
<span class="gp">$</span> go build ./src/gopl.io/ch1/helloworld
</pre></div>


<p>but not:</p>
<div class="codehilite"><pre><span class="gp">$</span> <span class="nb">cd</span> $GOPATH
<span class="gp">$</span> go build src/gopl.io/ch1/helloworld
<span class="go">Error: cannot find package &quot;src/gopl.io/ch1/helloworld&quot;.</span>
</pre></div>


<p>Packages may also be specified as a list of file names, though this tends to be used only for small programs and one-off experiments. If the package name is <code>main</code>, the executable name comes from the basename of the first <code>.go</code> file.</p>
<div class="codehilite"><pre><span class="gp">$</span> cat quoteargs.go
<span class="go">package main</span>
<span class="go">import (</span>
<span class="go">    &quot;fmt&quot;</span>
<span class="go">    &quot;os&quot;</span>
<span class="go">)</span>
<span class="go">func main() {</span>
<span class="go">    fmt.Printf(&quot;%q\n&quot;, os.Args[1:])</span>
<span class="go">}</span>
<span class="gp">$</span> go build quoteargs.go
<span class="gp">$</span> ./quoteargs one <span class="s2">&quot;two three&quot;</span> four<span class="se">\ </span>five
<span class="go">[&quot;one&quot; &quot;two three&quot; &quot;four five&quot;]</span>
</pre></div>


<p>For throwaway programs like this one, we can run the executable as soon as we've built it. The <a href="https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program"><code>go run</code></a> command combines these two steps:</p>
<div class="codehilite"><pre><span class="gp">$</span> go run quoteargs.go one <span class="s2">&quot;two three&quot;</span> four<span class="se">\ </span>five
<span class="go">[&quot;one&quot; &quot;two three&quot; &quot;four five&quot;]</span>
</pre></div>


<p>By default, the <code>go build</code> command builds the requested package and all its dependencies, then throws away all the compiled code except the final executable, if any. Both the dependency analysis and the compilation are surprisingly fast, but as projects grow to dozens of packages and hundreds of thousands of lines of code, the time to recompile dependencies can become noticeable, potentially several seconds, even when those dependencies haven't changed at all.</p>
<p>The <a href="https://golang.org/cmd/go/#hdr-Compile_and_install_packages_and_dependencies"><code>go install</code></a> command is very similar to <code>go build</code>, except that it saves the compiled code for each package and command instead of throwing it away. Compiled packages are saved beneath the <code>$GOPATH/pkg</code> directory corresponding to the <code>src</code> directory in which the source resides, and command executables are saved in the <code>$GOPATH/bin</code> directory. Thereafter, <code>go build</code> and <code>go install</code> do not run the compiler for those packages and commands if they have not changed, making subsequent builds much faster. For convenience, <code>go build -i</code> installs the packages that are dependencies of the build target.</p>
<p>Since compiled packages vary by platform and architecture, <code>go install</code> saves them beneath a subdirectory whose name incorporates the values of the <code>GOOS</code> and <code>GOARCH</code> environment variables. For example, on a Mac the <code>golang.org/x/net/html</code> package is compiled and installed in the file <code>golang.org/x/net/html.a</code> under <code>$GOPATH/pkg/darwin_amd64</code>.</p>
<p>It is straightforward to <a href="https://en.wikipedia.org/wiki/Cross_compiler"><em>cross-compile</em></a> a Go program, that is, to build an executable intended for a different operating system or CPU. This can be done by setting the <code>GOOS</code> or <code>GOARCH</code> variables during the build. The <code>cross</code> program below prints the operating system and architecture for which it was built:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch10/cross/main.go">gopl.io/ch10/cross/main.go</a></small></p>
<div class="codehilite"><pre><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">GOOS</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">GOARCH</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>The following commands produce 64-bit and 32-bit executables respectively:</p>
<div class="codehilite"><pre><span class="gp">$</span> go build gopl.io/ch10/cross
<span class="gp">$</span> ./cross
<span class="go">darwin amd64</span>
<span class="gp">$</span> <span class="nv">GOARCH</span><span class="o">=</span><span class="m">386</span> go build gopl.io/ch10/cross
<span class="gp">$</span> ./cross
<span class="go">darwin 386</span>
</pre></div>


<p>Some packages may need to compile different versions of the code for certain platforms or processors, for example, to deal with low-level portability issues or to provide optimized versions of important routines. If a file name includes an operating system or processor architecture name like <code>net_linux.go</code> or <code>asm_amd64.s</code>, then the <code>go</code> tool will compile the file only when building for that target.</p>
<p>Special comments called build tags give more fine-grained control. For example, if a file contains the following comment before the package declaration (and its doc comment):</p>
<div class="codehilite"><pre>// +build linux darwin
</pre></div>


<p><code>go build</code> will compile it only when building for Linux or Mac OS X.</p>
<p>The following comment says never to compile the file:</p>
<div class="codehilite"><pre>// +build ignore
</pre></div>


<p>For more details, see the <a href="https://golang.org/pkg/go/build/#hdr-Build_Constraints"><em>Build Constraints</em></a> section of the <a href="https://golang.org/pkg/go/build/"><code>go/build</code></a> package's documentation:</p>
<div class="codehilite"><pre><span class="gp">$</span> go doc go/build
</pre></div>


<h4 id="documenting-packages">Documenting Packages<a class="headerlink" href="#documenting-packages" title="Permanent link">&para;</a></h4>
<p>Go style strongly encourages good documentation of package APIs. Each declaration of an exported package member and the package declaration itself should be immediately preceded by a comment explaining its purpose and usage.</p>
<p>Go <em>doc comments</em> are always complete sentences, and the first sentence is usually a summary that starts with the name being declared. Function parameters and other identifiers are mentioned without quotation or markup. For example, the following is the doc comment for <code>fmt.Fprintf</code>:</p>
<div class="codehilite"><pre><span class="c1">// Fprintf formats according to a format specifier and writes to w.</span>
<span class="c1">// It returns the number of bytes written and any write error encountered.</span>
<span class="kd">func</span> <span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">a</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>


<p>The details of <code>Fprintf</code>'s formatting are explained in a doc comment associated with the <code>fmt</code> package itself. A comment immediately preceding a package declaration is considered the doc comment for the package as a whole. There must be only one, though it may appear in any file. Longer package comments may warrant a file of their own. For example, <code>fmt</code>'s package comment is over 300 lines. This file is usually called <code>doc.go</code> (e.g. <a href="https://golang.org/src/fmt/doc.go"><code>fmt/doc.go</code></a>).</p>
<p>Go's conventions favor brevity and simplicity in documentation as in all things, since documentation also requires maintenance just like code. Many declarations can be explained in one well-worded sentence, and if the behavior is truly obvious, no comment is needed.</p>
<p>Two tools can help you find better examples as you browse the standard library.</p>
<h5 id="go-doc"><strong><code>go doc</code></strong> *<a class="headerlink" href="#go-doc" title="Permanent link">&para;</a></h5>
<p>The <code>go doc</code> tool prints the declaration and doc comment of the entity specified on the command line, which may be a package:</p>
<div class="codehilite"><pre><span class="gp">$</span> go doc <span class="nb">time</span>
<span class="go">package time // import &quot;time&quot;</span>

<span class="go">Package time provides functionality for measuring and displaying time.</span>

<span class="go">const Nanosecond Duration = 1 ...</span>
<span class="go">func After(d Duration) &lt;-chan Time</span>
<span class="go">func Sleep(d Duration)</span>
<span class="go">func Since(t Time) Duration</span>
<span class="go">func Now() Time</span>
<span class="go">type Duration int64</span>
<span class="go">type Time struct { ... }</span>
<span class="go">...</span>
</pre></div>


<p>or a package member:</p>
<div class="codehilite"><pre><span class="gp">$</span> go doc time.Since
<span class="go">func Since(t Time) Duration</span>

<span class="go">    Since returns the time elapsed since t.</span>
<span class="go">    It is shorthand for time.Now().Sub(t).</span>
</pre></div>


<p>or a method:</p>
<div class="codehilite"><pre><span class="gp">$</span> go doc time.Duration.Seconds
<span class="go">func (d Duration) Seconds() float64</span>

<span class="go">    Seconds returns the duration as a floating-point number of seconds.</span>
</pre></div>


<p>The tool does not need complete import paths or correct identifier case. For example, this command prints the documentation of <code>(*json.Decoder).Decode</code> from the <code>encoding/json</code> package:</p>
<div class="codehilite"><pre><span class="gp">$</span> go doc json.decode
<span class="go">func (dec *Decoder) Decode(v interface{}) error</span>

<span class="go">    Decode reads the next JSON-encoded value from its input and stores</span>
<span class="go">    it in the value pointed to by v.</span>
</pre></div>


<h5 id="godoc"><strong><code>godoc</code></strong> *<a class="headerlink" href="#godoc" title="Permanent link">&para;</a></h5>
<p>The second tool, confusingly named <a href="https://godoc.org/golang.org/x/tools/cmd/godoc"><code>godoc</code></a>, serves cross-linked HTML pages that provide the same information as <code>go doc</code> and much more. The godoc server at <a href="https://golang.org/pkg">https://golang.org/pkg</a> covers the standard library. The godoc server at <a href="https://godoc.org">https://godoc.org</a> has a searchable index of thousands of open-source packages.</p>
<p>You can also run an instance of <code>godoc</code> in your workspace if you want to browse your own packages. Visit <a href="http://localhost:8000/pkg">http://localhost:8000/pkg</a> in your browser while running this command:</p>
<div class="codehilite"><pre><span class="gp">$</span> godoc -http :8000
</pre></div>


<p>Its <code>-analysis=type</code> and <code>-analysis=pointer</code> flags augment the documentation and the source code with the results of advanced static analysis.</p>
<h4 id="internal-packages">Internal Packages<a class="headerlink" href="#internal-packages" title="Permanent link">&para;</a></h4>
<p>The package is the most important mechanism for encapsulation in Go programs.</p>
<ul>
<li>Unexported identifiers are visible only within the same package.</li>
<li>Exported identifiers are visible to the world.</li>
</ul>
<p>Sometimes a middle ground would be helpful, a way to define identifiers that are visible to a small set of trusted packages, but not to everyone. For example:</p>
<ul>
<li>When we're breaking up a large package into more manageable parts, we may not want to reveal the interfaces between those parts to other packages.</li>
<li>We may want to share utility functions across several packages of a project without exposing them more widely.</li>
<li>We want to experiment with a new package without prematurely committing to its API, by putting it "on probation" with a limited set of clients.</li>
</ul>
<p>To address these needs, the <code>go build</code> tool treats a package specially if its import path contains a path segment named <code>internal</code>. Such packages are called <a href="https://golang.org/doc/go1.4#internalpackages"><em>internal packages</em></a>. An internal package may be imported only by another package that is inside the tree rooted at the parent of the internal directory. For example, given the packages below, <code>net/http/internal/chunked</code> can be imported from <code>net/http/httputil</code> or <code>net/http</code>, but not from <code>net/url</code>. However, <code>net/url</code> may import <code>net/http/httputil</code>.</p>
<div class="codehilite"><pre>net/http
net/http/internal/chunked
net/http/httputil
net/url
</pre></div>


<h4 id="querying-packages">Querying Packages<a class="headerlink" href="#querying-packages" title="Permanent link">&para;</a></h4>
<p>The <a href="https://golang.org/cmd/go/#hdr-List_packages"><code>go list</code></a> tool reports information about available packages. In its simplest form, <code>go list</code> tests whether a package is present in the workspace and prints its import path if so:</p>
<div class="codehilite"><pre><span class="err">$</span> <span class="k">go</span> <span class="nx">list</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">sql</span><span class="o">-</span><span class="nx">driver</span><span class="o">/</span><span class="nx">mysql</span>
<span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">sql</span><span class="o">-</span><span class="nx">driver</span><span class="o">/</span><span class="nx">mysql</span>
</pre></div>


<p>An argument to go list may contain the "<code>...</code>" wildcard, which matches any substring of a package's import path. We can use it to enumerate all the packages within a Go workspace:</p>
<div class="codehilite"><pre><span class="gp">$</span> go list ...
<span class="go">archive/tar</span>
<span class="go">archive/zip</span>
<span class="go">bufio</span>
<span class="go">bytes</span>
<span class="go">cmd/addr2line</span>
<span class="go">cmd/api</span>
<span class="go">...</span>
</pre></div>


<p>Or within a specific subtree:</p>
<div class="codehilite"><pre><span class="gp">$</span> go list gopl.io/ch3/...
<span class="go">gopl.io/ch3/basename1</span>
<span class="go">gopl.io/ch3/basename2</span>
<span class="go">gopl.io/ch3/comma</span>
<span class="go">gopl.io/ch3/mandelbrot</span>
<span class="go">gopl.io/ch3/netflag</span>
<span class="go">gopl.io/ch3/printints</span>
<span class="go">gopl.io/ch3/surface</span>
</pre></div>


<p>Or related to a particular topic:</p>
<div class="codehilite"><pre><span class="gp">$</span> go list ...xml...
<span class="go">encoding/xml</span>
<span class="go">gopl.io/ch7/xmlselect</span>
</pre></div>


<p>The <code>go list</code> command obtains the complete metadata for each package. The <code>-json</code> flag causes <code>go list</code> to print the entire record of each package in JSON format:</p>
<div class="codehilite"><pre><span class="gp">$</span> go list -json <span class="nb">hash</span>
<span class="go">{</span>
<span class="go">    &quot;Dir&quot;: &quot;/home/gopher/go/src/hash&quot;,</span>
<span class="go">    &quot;ImportPath&quot;: &quot;hash&quot;,</span>
<span class="go">    &quot;Name&quot;: &quot;hash&quot;,</span>
<span class="go">    &quot;Doc&quot;: &quot;Package hash provides interfaces for hash functions.&quot;,</span>
<span class="go">    &quot;Target&quot;: &quot;/home/gopher/go/pkg/darwin_amd64/hash.a&quot;,</span>
<span class="go">    &quot;Goroot&quot;: true,</span>
<span class="go">    &quot;Standard&quot;: true,</span>
<span class="go">    &quot;Root&quot;: &quot;/home/gopher/go&quot;,</span>
<span class="go">    &quot;GoFiles&quot;: [</span>
<span class="go">        &quot;hash.go&quot;</span>
<span class="go">    ],</span>
<span class="go">    &quot;Imports&quot;: [</span>
<span class="go">        &quot;io&quot;</span>
<span class="go">    ],</span>
<span class="go">    &quot;Deps&quot;: [</span>
<span class="go">        &quot;errors&quot;,</span>
<span class="go">        &quot;io&quot;,</span>
<span class="go">        &quot;runtime&quot;,</span>
<span class="go">        &quot;sync&quot;,</span>
<span class="go">        &quot;sync/atomic&quot;,</span>
<span class="go">        &quot;unsafe&quot;</span>
<span class="go">    ]</span>
<span class="go">}</span>
</pre></div>


<p>The <code>-f</code> flag customizes the output format using the template language of package <a href="https://golang.org/pkg/text/template/"><code>text/template</code></a> (<a href="../ch4/#text-and-html-templates">Section 4.6</a>). The following command prints the transitive dependencies of the <code>strconv</code> package, separated by spaces:</p>
<div class="codehilite"><pre><span class="gp">$</span> go list -f <span class="s1">&#39;{{join .Deps &quot; &quot;}}&#39;</span> strconv
<span class="go">errors math runtime unicode/utf8 unsafe</span>
</pre></div>


<p>The following command prints the direct imports of each package in the compress subtree of the standard library:</p>
<div class="codehilite"><pre><span class="gp">$</span> go list -f <span class="s1">&#39;{{.ImportPath}} -&gt; {{join .Imports &quot; &quot;}}&#39;</span> compress/...
<span class="go">compress/bzip2 -&gt; bufio io sort</span>
<span class="go">compress/flate -&gt; bufio fmt io math sort strconv</span>
<span class="go">compress/gzip -&gt; bufio compress/flate errors fmt hash hash/crc32 io time</span>
<span class="go">compress/lzw -&gt; bufio errors fmt io</span>
<span class="go">compress/zlib -&gt; bufio compress/flate errors fmt hash hash/adler32 io</span>
</pre></div>


<p>The <code>go list</code> command is useful for both one-off interactive queries and for build and test automation scripts. It will be used again in <a href="../ch11/#external-test-packages">Section 11.2.4</a>. For more information, including the set of available fields and their meaning, see the output of <code>go help list</code>.</p>
            </div>
        </div>

        <footer class="col-md-12">
            
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../custom.js"></script>
    </body>
</html>