<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Global Site Tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-59055167-2"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-59055167-2');
        </script>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/gopl/ch1/">
        <link rel="shortcut icon" href="../../toki_32.png">
        

	<title>Chapter 1. Tutorial - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,400italic,500,600" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">
        <link href="../../friendly.css" rel="stylesheet">
        <link href="../../theme.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../apue/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch3/">Chapter 3. File I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch4/">Chapter 4. Files and Directories</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch5/">Chapter 5. Standard I/O Library</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch6/">Chapter 6. System Data Files and Information</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch7/">Chapter 7. Process Environment</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch8/">Chapter 8. Process Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch9/">Chapter 9. Process Relationships</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch10/">Chapter 10. Signals</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch11/">Chapter 11. Threads</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch12/">Chapter 12. Thread Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch13/">Chapter 13. Daemon Processes</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch14/">Chapter 14. Advanced I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch15/">Chapter 15. Interprocess Communication</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch16/">Chapter 16. Network IPC: Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch17/">Chapter 17. Advanced IPC</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../unp/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch3/">Chapter 3. Sockets Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch4/">Chapter 4. Elementary TCP Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch5/">Chapter 5. TCP Client/Server Example</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch6/">Chapter 6. I/O Multiplexing: The select and poll Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch7/">Chapter 7. Socket Options</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch8/">Chapter 8. Elementary UDP Sockets</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TCPv1 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../tcpv1/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch2/">Chapter 2. The Internet Address Architecture</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch3/">Chapter 3. Link Layer</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch4/">Chapter 4. ARP: Address Resolution Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch5/">Chapter 5. The Internet Protocol (IP)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch6/">Chapter 6. System Configuration: DHCP and Autoconfiguration</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch7/">Chapter 7. Firewalls and Network Address Translation (NAT)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch8/">Chapter 8. ICMPv4 and ICMPv6: Internet Control Message Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch9/">Chapter 9. Broadcasting and Local Multicasting (IGMP and MLD)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch10/">Chapter 10. User Datagram Protocol (UDP) and IP Fragmentation</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch11/">Chapter 11. Name Resolution and the Domain Name System (DNS)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch12/">Chapter 12. TCP: The Transmission Control Protocol (Preliminaries)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch13/">Chapter 13. TCP Connection Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch14/">Chapter 14. TCP Timeout and Retransmission</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch15/">Chapter 15. TCP Data Flow and Window Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch16/">Chapter 16. TCP Congestion Control</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch17/">Chapter 17. TCP Keepalive</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch18/">Chapter 18. Security: EAP, IPsec, TLS, DNSSEC, and DKIM</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/headers/">Headers</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">GOPL <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../">Contents</a>
                        </li>
                      
                        <li class="active">
                            <a href="./">Chapter 1. Tutorial</a>
                        </li>
                      
                        <li>
                            <a href="../ch2/">Chapter 2. Program Structure</a>
                        </li>
                      
                        <li>
                            <a href="../ch3/">Chapter 3. Basic Data Types</a>
                        </li>
                      
                        <li>
                            <a href="../ch4/">Chapter 4. Composite Types</a>
                        </li>
                      
                        <li>
                            <a href="../ch5/">Chapter 5. Functions</a>
                        </li>
                      
                        <li>
                            <a href="../ch6/">Chapter 6. Methods</a>
                        </li>
                      
                        <li>
                            <a href="../ch7/">Chapter 7. Interfaces</a>
                        </li>
                      
                        <li>
                            <a href="../ch8/">Chapter 8. Goroutines and Channels</a>
                        </li>
                      
                        <li>
                            <a href="../ch9/">Chapter 9. Concurrency with Shared Variables</a>
                        </li>
                      
                        <li>
                            <a href="../ch10/">Chapter 10. Packages and the Go Tool</a>
                        </li>
                      
                        <li>
                            <a href="../ch11/">Chapter 11. Testing</a>
                        </li>
                      
                        <li>
                            <a href="../ch12/">Chapter 12. Reflection</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CSN <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../csn/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part1/">Part 1: Language</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part2/">Part 2: Advanced</a>
                        </li>
                      
                    </ul>
                </li>
            <li>
                    <a href="../../toc/">TOC</a>
                </li>
            </ul>
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    
                        <a href="https://github.com/shichao-an/notes/blob/master/docs/gopl/ch1.md">
                    
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-1-tutorial">Chapter 1. Tutorial</a></li>
        
    
        <li class="main "><a href="#hello-world">Hello, World</a></li>
        
    
        <li class="main "><a href="#command-line-arguments">Command-Line Arguments</a></li>
        
            <li><a href="#slice-osargs">Slice os.Args *</a></li>
        
            <li><a href="#example-implementation-of-unix-echo-command">Example implementation of Unix echo command *</a></li>
        
            <li><a href="#comments-that-describe-the-program">Comments that describe the program *</a></li>
        
            <li><a href="#variables-declarations-and-assignment">Variables, declarations and assignment *</a></li>
        
            <li><a href="#for-loop">for loop *</a></li>
        
    
        <li class="main "><a href="#finding-duplicate-lines">Finding Duplicate Lines</a></li>
        
            <li><a href="#if-statement">if statement *</a></li>
        
            <li><a href="#map-that-holds-counts">map that holds counts *</a></li>
        
            <li><a href="#bufioscanner-function">bufio.Scanner function</a></li>
        
            <li><a href="#fmtprintf-function">fmt.Printf function</a></li>
        
            <li><a href="#osopen-function">os.Open function</a></li>
        
    
        <li class="main "><a href="#animated-gifs">Animated GIFs</a></li>
        
            <li><a href="#package-names-with-multiple-components">Package names with multiple components *</a></li>
        
            <li><a href="#constant-declarations">constant declarations *</a></li>
        
            <li><a href="#composite-literals">Composite literals *</a></li>
        
            <li><a href="#structs">Structs *</a></li>
        
            <li><a href="#the-lissajous-function">The lissajous function *</a></li>
        
    
        <li class="main "><a href="#fetching-a-url">Fetching a URL</a></li>
        
    
        <li class="main "><a href="#fetching-urls-concurrently">Fetching URLs Concurrently</a></li>
        
    
        <li class="main "><a href="#a-web-server">A Web Server</a></li>
        
            <li><a href="#echoing-url-path">Echoing URL path *</a></li>
        
            <li><a href="#request-counter">Request counter *</a></li>
        
            <li><a href="#inspecting-requests">Inspecting requests *</a></li>
        
    
        <li class="main "><a href="#loose-ends">Loose Ends</a></li>
        
            <li><a href="#control-flow">Control flow</a></li>
        
            <li><a href="#named-types">Named types</a></li>
        
            <li><a href="#pointers">Pointers</a></li>
        
            <li><a href="#methods-and-interfaces">Methods and interfaces</a></li>
        
            <li><a href="#packages">Packages</a></li>
        
            <li><a href="#comments">Comments</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
              

<h3 id="chapter-1-tutorial"><strong>Chapter 1. Tutorial</strong><a class="headerlink" href="#chapter-1-tutorial" title="Permanent link">&para;</a></h3>
<p>This chapter is a tour of the basic components of Go. We hope to provide enough information and examples to get you off the ground and doing useful things as quickly as possible.</p>
<p>When you’re learning a new language, there’s a natural tendency to write code as you would have written it in a language you already know. Be aware of this bias as you learn Go and try to avoid it. We’ve tried to illustrate and explain how to write good Go, so use the code here as a guide when you’re writing your own.</p>
<h3 id="hello-world">Hello, World<a class="headerlink" href="#hello-world" title="Permanent link">&para;</a></h3>
<p>We'll start with the now-traditional "hello, world" example, which appears at the beginning of <a href="https://en.wikipedia.org/wiki/The_C_Programming_Language"><em>The C Programming Language</em></a>, published in 1987.</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/helloworld/main.go">gopl.io/ch1/helloworld/main.go</a></small></p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, 世界&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>Go is a compiled language:</p>
<ul>
<li>The Go toolchain converts a source program and the things it depends on into instructions in the native machine language of a computer.</li>
<li>These tools are accessed through a single command called <code>go</code> that has a number of subcommands. The simplest of these subcommands is <code>run</code>, which compiles the source code from one or more source files whose names end in <code>.go</code>, links it with libraries, then runs the resulting executable file.</li>
</ul>
<div class="codehilite"><pre><span class="gp">$</span> go run helloworld.go
</pre></div>


<p>Go natively handles Unicode, so it can process text in all the world’s languages.</p>
<p>If the program is more than a one-shot experiment, you can compile it once and save the compiled result for later use, which is done with <code>go build</code>:</p>
<div class="codehilite"><pre><span class="gp">$</span> go build helloworld.go
</pre></div>


<p>This creates an executable binary file called <code>helloworld</code> that can be run any time without further processing:</p>
<div class="codehilite"><pre><span class="gp">$</span> ./helloworld
<span class="go">Hello, 世界</span>
</pre></div>


<p>If you run <code>go get gopl.io/ch1/helloworld</code>, it will fetch the source code and place it in the corresponding directory. There’s more about this topic in <a href="../ch2/#packages-and-files">Section 2.6</a> and <a href="../ch10/#the-go-tool">Section 10.7</a>.</p>
<p>Go code is organized into packages (similar to libraries or modules in other languages). A package consists of <code>.go</code> source files in a single directory that define what the package does. Each source file begins with the following things in order:</p>
<ol>
<li>A package declaration (e.g. <code>package main</code>) that states which package the file belongs to,</li>
<li>A list of other packages that it imports,</li>
<li>The declarations of the program that are stored in that file.</li>
</ol>
<p>Package <code>main</code> is special. It defines a standalone executable program, not a library. Within package <code>main</code> the function <code>main</code> is also special: it’s where execution of the program begins. <code>main</code> will normally call upon functions in other packages to do much of the work, such as the function <code>fmt.Println</code>.</p>
<p>The <code>import</code> declaration tells the compiler what packages are needed by this source file. The "hello, world" program uses only one function from one other package, but most programs will import more packages.  You must import exactly the packages you need. <u>A program will not compile if there are missing imports or if there are unnecessary ones.</u> This strict requirement prevents references to unused packages from accumulating as programs evolve.</p>
<p>The <code>import</code> declarations must follow the package declaration. After that, a program consists of the declarations of functions, variables, constants, and types (keywords <code>func</code>, <code>var</code>, <code>const</code>, and <code>type</code>); for the most part, the order of declarations does not matter. This program is about as short as possible since it declares only one function, which in turn calls only one other function.</p>
<p>A function declaration consists of the keyword <code>func</code>, the name of the function, a parameter
list (empty for <code>main</code>), a result list (also empty here), and the body of the function enclosed in braces. This is detailed in <a href="../ch5/">Chapter 5</a>.</p>
<p>Go does not require semicolons at the ends of statements or declarations, except where two or more appear on the same line. In effect, newlines following certain tokens are converted into semicolons, so where newlines are placed matters to proper parsing of Go code. For instance, the opening brace <code>{</code> of the function must be on the same line as the end of the <code>func</code> declaration, not on a line by itself, and in the expression <code>x + y</code>, a newline is permitted after but not before the <code>+</code> operator.</p>
<p>Go takes a strong stance on code formatting. The <code>gofmt</code> tool rewrites code into the standard format, and the go tool’s <code>fmt</code> subcommand applies <code>gofmt</code> to all the files in the specified package, or the ones in the current directory by default. All Go source files in the book have been run through <code>gofmt</code>. <u>Declaring a standard format by fiat eliminates a lot of pointless debate about trivia and, more importantly, enables a variety of automated source code transformations that would be infeasible if arbitrary formatting were allowed.</u></p>
<p>Many text editors can be configured to run <code>gofmt</code> each time you save a file, so that your source code is always properly formatted. A related tool, <code>goimports</code>, additionally manages the insertion and removal of import declarations as needed. It is not part of the standard distribution but you can obtain it with this command:</p>
<div class="codehilite"><pre><span class="gp">$</span> go get golang.org/x/tools/cmd/goimports
</pre></div>


<p>For most users, the usual way to download and build packages, run their tests, show their documentation, and so on, is with the go tool.</p>
<h3 id="command-line-arguments">Command-Line Arguments<a class="headerlink" href="#command-line-arguments" title="Permanent link">&para;</a></h3>
<p>The <code>os</code> package provides functions and other values for dealing with the operating system in a platform-independent fashion. Command-line arguments are available to a program as the variable <code>os.Args</code>.</p>
<h4 id="slice-osargs">Slice <code>os.Args</code> *<a class="headerlink" href="#slice-osargs" title="Permanent link">&para;</a></h4>
<p>The variable <code>os.Args</code> is a slice of strings. Slices are a fundamental notion in Go. For now, think of a slice as a dynamically sized sequence <code>s</code> of array elements where:</p>
<ul>
<li>Individual elements can be accessed as <code>s[i]</code>;</li>
<li>A contiguous subsequence can be accessed as <code>s[m:n]</code>.</li>
<li>The number of elements is given by <code>len(s)</code>.</li>
<li>As in most other programming languages, all indexing in Go uses half-open intervals that include the first index but exclude the last, because it simplifies logic. For example, the slice <code>s[m:n]</code>, where <code>0</code> ≤ <code>m</code> ≤ <code>n</code> ≤ <code>len(s)</code>, contains <code>n-m</code> elements.</li>
</ul>
<p>The first element of <code>os.Args</code>, <code>os.Args[0]</code>, is the name of the command itself; the other elements are the arguments that were presented to the program when it started execution. A slice expression of the form <code>s[m:n]</code> yields a slice that refers to elements <code>m</code> through <code>n-1</code>, so the elements we need for our next example are those in the slice <code>os.Args[1:len(os.Args)]</code>. If <code>m</code> or <code>n</code> is omitted, it defaults to 0 or <code>len(s)</code> respectively, so we can abbreviate the desired slice as <code>os.Args[1:]</code>.</p>
<h4 id="example-implementation-of-unix-echo-command">Example implementation of Unix <code>echo</code> command *<a class="headerlink" href="#example-implementation-of-unix-echo-command" title="Permanent link">&para;</a></h4>
<p>The following is an implementation of the Unix <code>echo</code> command, which prints its command-line arguments on a single line. <u>It imports two packages, which are given as a parenthesized list rather than as individual import declarations. Either form is legal, but conventionally the list form is used. The order of imports doesn’t matter; the <code>gofmt</code> tool sorts the package names into alphabetical order.</u></p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/echo1/main.go">gopl.io/ch1/echo1/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Echo1 prints its command-line arguments.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span> <span class="kt">string</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="nx">sep</span> <span class="o">+</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="nx">sep</span> <span class="p">=</span> <span class="s">&quot; &quot;</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<h4 id="comments-that-describe-the-program">Comments that describe the program *<a class="headerlink" href="#comments-that-describe-the-program" title="Permanent link">&para;</a></h4>
<p>Comments begin with <code>//</code>. By convention, we describe each package in a comment immediately preceding its package declaration; for a <code>main</code> package, this comment is one or more complete sentences that describe the program as a whole.</p>
<h4 id="variables-declarations-and-assignment">Variables, declarations and assignment *<a class="headerlink" href="#variables-declarations-and-assignment" title="Permanent link">&para;</a></h4>
<p>The <code>var</code> declaration declares two variables <code>s</code> and <code>sep</code>, of type <code>string</code>. A variable can be initialized as part of its declaration. If it is not explicitly initialized, it is implicitly initialized to the <a href="https://golang.org/ref/spec#The_zero_value">zero value</a> for its type, which is 0 for numeric types and the empty string "" for strings. In this example, the declaration implicitly initializes <code>s</code> and <code>sep</code> to empty strings. Variables and declarations are detailed in <a href="../ch2/">Chapter 2</a>.</p>
<p>The statement:</p>
<div class="codehilite"><pre><span class="nx">s</span> <span class="o">+=</span> <span class="nx">sep</span> <span class="o">+</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</pre></div>


<p>is an <strong>assignment statement</strong> that concatenates the old value of <code>s</code> with <code>sep</code> and <code>os.Args[i]</code> and assigns it back to <code>s</code>; it is equivalent to:</p>
<div class="codehilite"><pre><span class="nx">s</span> <span class="p">=</span> <span class="nx">s</span> <span class="o">+</span> <span class="nx">sep</span> <span class="o">+</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</pre></div>


<p>The operator <code>+=</code> is an <strong>assignment operator</strong>. Each arithmetic and logical operator like + or * has a corresponding assignment operator.</p>
<p>A number of improved versions of <code>echo</code> will be shown in this chapter and the next that will deal with any real inefficiency.</p>
<h4 id="for-loop"><code>for</code> loop *<a class="headerlink" href="#for-loop" title="Permanent link">&para;</a></h4>
<p>The loop index variable <code>i</code> is declared in the first part of the <code>for</code> loop. The <code>:=</code> symbol is part of a <strong>short variable declaration</strong>, a statement that declares one or more variables and gives them appropriate types based on the initializer values (detailed in the next chapter). The increment statement <code>i++</code> adds 1 to <code>i</code>; it’s equivalent to <code>i += 1</code> which is in turn equivalent to <code>i = i + 1</code>. There’s a corresponding decrement statement <code>i--</code> that subtracts 1. These are statements, not expressions as they are in most languages in the C family, so <code>j = i++</code> is illegal, and they are postfix only, so <code>--i</code> is not legal either.</p>
<p>The <code>for</code> loop is the only loop statement in Go. It has a number of forms, one of which is illustrated here:</p>
<div class="codehilite"><pre>for initialization; condition; post {
    // zero or more statements
}
</pre></div>


<p>In the above form, parentheses are never used around the three components of a <code>for</code> loop. The braces are mandatory, and the opening brace must be on the same line as the <em>post</em> statement. The three statements are:</p>
<ul>
<li>The optional <em>initialization</em> statement is executed before the loop starts. If it is present, it must be a <strong>simple statement</strong>, which is one of the following:<ul>
<li>A short variable declaration,</li>
<li>An increment or assignment statement,</li>
<li>A function call.</li>
</ul>
</li>
<li>The <em>condition</em> is a boolean expression evaluated at the beginning of each iteration of the loop; if it evaluates to true, the statements controlled by the loop are executed.</li>
<li>The <em>post</em> statement is executed after the body of the loop, then the condition is evaluated again. The loop ends when the condition becomes false.</li>
</ul>
<p>Any of these parts may be omitted.</p>
<p>If there is no <em>initialization</em> and no <em>post</em>, the semicolons may also be omitted:</p>
<h5 id="for-as-a-while-loop"><strong><code>for</code> as a "while" loop</strong> *<a class="headerlink" href="#for-as-a-while-loop" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span class="c1">// a traditional &quot;while&quot; loop</span>
<span class="k">for</span> <span class="nx">condition</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>


<p>If the <em>condition</em> is omitted entirely in any of these forms, for example in</p>
<div class="codehilite"><pre><span class="c1">// a traditional infinite loop</span>
<span class="k">for</span> <span class="p">{</span>
<span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>


<p>This loop is infinite, though it may be terminated in some other way, like a <code>break</code> or <code>return</code> statement.</p>
<h5 id="for-as-iteration"><strong><code>for</code> as iteration</strong> *<a class="headerlink" href="#for-as-iteration" title="Permanent link">&para;</a></h5>
<p>Another form of the for loop iterates over a range of values from a data type like a string or a slice:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/echo2/main.go">gopl.io/ch1/echo2/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Echo2 prints its command-line arguments.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s</span><span class="p">,</span> <span class="nx">sep</span> <span class="o">:=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">arg</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="nx">sep</span> <span class="o">+</span> <span class="nx">arg</span>
        <span class="nx">sep</span> <span class="p">=</span> <span class="s">&quot; &quot;</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>In each iteration, <code>range</code> produces a pair of values: the index and the value of the element at that index. Here, we don’t need the index, but the <code>range</code> loop requires that we deal with both the element and the index. Since Go does not permit unused local variables (which would result in a compilation error), the solution is to use the <strong>blank identifier</strong>, whose name is <code>_</code> (an underscore). The blank identifier may be used whenever syntax requires a variable name but program logic does not, for instance to discard an unwanted loop index when we require only the element value.</p>
<h5 id="equivalent-ways-of-declaring-string-variables"><strong>Equivalent ways of declaring string variables</strong> *<a class="headerlink" href="#equivalent-ways-of-declaring-string-variables" title="Permanent link">&para;</a></h5>
<p>There are several ways to declare a string variable; these are all equivalent:</p>
<div class="codehilite"><pre><span class="nx">s</span> <span class="o">:=</span> <span class="s">&quot;&quot;</span>
<span class="kd">var</span> <span class="nx">s</span> <span class="kt">string</span>
<span class="kd">var</span> <span class="nx">s</span> <span class="p">=</span> <span class="s">&quot;&quot;</span>
<span class="kd">var</span> <span class="nx">s</span> <span class="kt">string</span> <span class="p">=</span> <span class="s">&quot;&quot;</span>
</pre></div>


<ol>
<li>The first form is a short variable declaration and is the most compact, but it may be used only within a function, not for package-level variables.</li>
<li>The second form relies on default initialization to the zero value for strings, which is "".</li>
<li>The third form is rarely used except when declaring multiple variables.</li>
<li>The fourth form is explicit about the variable’s type, which is redundant when it is the same as that of the initial value but necessary in other cases where they are not of the same type.</li>
</ol>
<p>In practice, you should generally use one of the first two forms, with explicit initialization to say that the initial value is important and implicit initialization to say that the initial value doesn’t matter.</p>
<p>Each time around the loop, the string s gets completely new contents. The <code>+=</code> statement makes a new string by concatenating the old string, a space character, and the next argument, then assigns the new string to <code>s</code>. <u>The old contents of <code>s</code> are no longer in use, so they will be garbage-collected in due course.</u></p>
<h5 id="stringsjoin-function"><strong><code>strings.Join</code> function</strong><a class="headerlink" href="#stringsjoin-function" title="Permanent link">&para;</a></h5>
<p>If the amount of data involved is large, this could be costly. A simpler and more efficient solution would be to use the <code>Join</code> function from the <code>strings</code> package:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/echo3/main.go">gopl.io/ch1/echo3/main.go</a></small></p>
<div class="codehilite"><pre><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&quot; &quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>


<p>If we don’t care about format but just want to see the values, perhaps for debugging, we can let <code>Println</code> format the results for us:</p>
<div class="codehilite"><pre><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>


<h3 id="finding-duplicate-lines">Finding Duplicate Lines<a class="headerlink" href="#finding-duplicate-lines" title="Permanent link">&para;</a></h3>
<p>This section shows three variants of a program called <code>dup</code>; it is partly inspired by the Unix <code>uniq</code> command, which looks for adjacent duplicate lines.</p>
<p>The first version of <code>dup</code> prints each line that appears more than once in the standard input, preceded by its count. This program introduces the following:</p>
<ul>
<li><code>if</code> statement</li>
<li><code>map</code> data type</li>
<li><code>bufio</code> package</li>
</ul>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/dup1/main.go">gopl.io/ch1/dup1/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Dup1 prints the text of each line that appears more than</span>
<span class="c1">// once in the standard input, preceded by its count.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">counts</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
    <span class="nx">input</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">input</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">counts</span><span class="p">[</span><span class="nx">input</span><span class="p">.</span><span class="nx">Text</span><span class="p">()]</span><span class="o">++</span>
    <span class="p">}</span>
    <span class="c1">// NOTE: ignoring potential errors from input.Err()</span>
    <span class="k">for</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">n</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">counts</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d\t%s\n&quot;</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">line</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h4 id="if-statement"><code>if</code> statement *<a class="headerlink" href="#if-statement" title="Permanent link">&para;</a></h4>
<p>As with <code>for</code>, parentheses are never used around the condition in an <code>if</code> statement, but braces are required for the body. There can be an optional <code>else</code> part that is executed if the condition is false.</p>
<h4 id="map-that-holds-counts"><code>map</code> that holds <code>counts</code> *<a class="headerlink" href="#map-that-holds-counts" title="Permanent link">&para;</a></h4>
<p>A <strong>map</strong> holds a set of key/value pairs and provides constant-time operations to store, retrieve, or test for an item in the set.</p>
<ul>
<li>The key may be of any type whose values can compared with <code>==</code>, strings being the most common example;</li>
<li>The value may be of any type at all.</li>
</ul>
<p>In this example, the keys are <code>string</code>s and the values are <code>int</code>s. The built-in function <code>make</code> creates a new empty map. Maps are detailed in <a href="../ch4/#maps">Section 4.3</a>.</p>
<p>The statement <code>counts[input.Text()]++</code> is equivalent to these two statements:</p>
<div class="codehilite"><pre><span class="nx">line</span> <span class="o">:=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">Text</span><span class="p">()</span>
<span class="nx">counts</span><span class="p">[</span><span class="nx">line</span><span class="p">]</span> <span class="p">=</span> <span class="nx">counts</span><span class="p">[</span><span class="nx">line</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>


<p>It’s not a problem if the map doesn’t yet contain that key. The first time a new line is seen, the expression <code>counts[line]</code> on the right-hand side evaluates to the zero value for its type, which is 0 for <code>int</code>.</p>
<p>To print the results, we use another <code>range</code>-based <code>for</code> loop, this time over the <code>counts</code> map. Each iteration produces two results, a key and the value of the map element for that key. <u>The order of map iteration is not specified, but in practice it is random, varying from one run to another. This design is intentional, since it prevents programs from relying on any particular ordering where none is guaranteed.</u></p>
<h4 id="bufioscanner-function"><code>bufio.Scanner</code> function<a class="headerlink" href="#bufioscanner-function" title="Permanent link">&para;</a></h4>
<p>The <code>bufio</code> package helps make input and output efficient and convenient. One of its most useful features is a type called <code>Scanner</code> that reads input and breaks it into lines or words; it’s often the easiest way to process input that comes naturally in lines.</p>
<p>The program uses a short variable declaration to create a new variable <code>input</code> that refers to a <code>bufio.Scanner</code>:</p>
<div class="codehilite"><pre><span class="nx">input</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
</pre></div>


<p>The scanner reads from the program’s standard input. Each call to <code>input.Scan()</code> reads the next line and removes the newline character from the end; the result can be retrieved by calling <code>input.Text()</code>. The <code>Scan</code> function returns <code>true</code> if there is a line and <code>false</code> when there is no more input.</p>
<h4 id="fmtprintf-function"><code>fmt.Printf</code> function<a class="headerlink" href="#fmtprintf-function" title="Permanent link">&para;</a></h4>
<p>The function <code>fmt.Printf</code> produces formatted output from a list of expressions. Its first argument is a format string that specifies how subsequent arguments should be formatted. The format of each argument is determined by a conversion character, a letter following a percent sign.</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%d</code></td>
<td>decimal integer</td>
</tr>
<tr>
<td><code>%x</code>, <code>%o</code>, <code>%b</code></td>
<td>integer in hexadecimal, octal, binary</td>
</tr>
<tr>
<td><code>%f</code>, <code>%g</code>, <code>%e</code></td>
<td>floating-point number: <code>3.141593</code> <code>3.141592653589793</code> <code>3.141593e+00</code></td>
</tr>
<tr>
<td><code>%t</code></td>
<td>boolean: <code>true</code> or <code>false</code></td>
</tr>
<tr>
<td><code>%c</code></td>
<td>rune (Unicode code point)</td>
</tr>
<tr>
<td><code>%s</code></td>
<td>string</td>
</tr>
<tr>
<td><code>%q</code></td>
<td>quoted string <code>"abc"</code> or rune <code>'c'</code></td>
</tr>
<tr>
<td><code>%v</code></td>
<td>any value in a natural format</td>
</tr>
<tr>
<td><code>%T</code></td>
<td>type of any value</td>
</tr>
<tr>
<td><code>%%</code></td>
<td>literal percent sign (no operand)</td>
</tr>
</tbody>
</table>
<p><code>\t</code> (tab) and <code>\n</code> (newline) are <strong>escape sequences</strong> for representing otherwise invisible characters. <code>Printf</code> does not write a newline by default. By convention:</p>
<ul>
<li>Formatting functions whose names end in <code>f</code>, such as <code>log.Printf</code> and <code>fmt.Errorf</code>, use the formatting rules of <code>fmt.Printf</code>;</li>
<li>Formatting functions whose names end in <code>ln</code> use the formatting rules of <code>fmt.Println</code>, formatting their arguments as if by <code>%v</code>, followed by a newline.</li>
</ul>
<h4 id="osopen-function"><code>os.Open</code> function<a class="headerlink" href="#osopen-function" title="Permanent link">&para;</a></h4>
<p>The next version of <code>dup</code> can read from the standard input or handle a list of file names, using <code>os.Open</code> to open each one:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/dup2/main.go">gopl.io/ch1/dup2/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Dup2 prints the count and text of lines that appear more than once</span>
<span class="c1">// in the input.  It reads from stdin or from a list of named files.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">counts</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
    <span class="nx">files</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">countLines</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">,</span> <span class="nx">counts</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">arg</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">files</span> <span class="p">{</span>
            <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="s">&quot;dup2: %v\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="p">}</span>
            <span class="nx">countLines</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">counts</span><span class="p">)</span>
            <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">n</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">counts</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d\t%s\n&quot;</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">line</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">countLines</span><span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span> <span class="nx">counts</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">input</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">input</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">counts</span><span class="p">[</span><span class="nx">input</span><span class="p">.</span><span class="nx">Text</span><span class="p">()]</span><span class="o">++</span>
    <span class="p">}</span>
    <span class="c1">// NOTE: ignoring potential errors from input.Err()</span>
<span class="p">}</span>
</pre></div>


<p>The function <code>os.Open</code> returns two values:</p>
<ol>
<li>The first is an open file (<code>*os.File</code>) used in subsequent reads by the <code>Scanner</code>.</li>
<li>The second result of <code>os.Open</code> is a value of the built-in error type:<ul>
<li>If <code>err</code> equals the special built-in value <code>nil</code>, the file was opened successfully. The file is read, and when the end of the input is reached, <code>Close</code> closes the file and releases any resources.</li>
<li>If <code>err</code> is not <code>nil</code>, something went wrong; the error value describes the problem.</li>
</ul>
</li>
</ol>
<p>In this program, the error handling prints a message on the standard error stream using <code>Fprintf</code> and
the verb <code>%v</code>, which displays a value of any type in a default format. The details of error handling are in <a href="../ch5/#errors">Section 5.4</a>.</p>
<p><u>Notice that the call to <code>countLines</code> precedes its declaration. Functions and other package-level entities may be declared in any order.</u></p>
<h3 id="animated-gifs">Animated GIFs<a class="headerlink" href="#animated-gifs" title="Permanent link">&para;</a></h3>
<p>The next program demonstrates usage of Go’s standard image packages to create a sequence of bit-mapped images and then encode the sequence as a GIF animation, called <a href="https://en.wikipedia.org/wiki/Lissajous_curve">Lissajous figures</a>.</p>
<p>There are several new constructs in this code, including <code>const</code> declarations, struct types, and composite literals, and also involves floating-point computations.</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/lissajous/main.go">gopl.io/ch1/lissajous/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Lissajous generates GIF animations of random Lissajous figures.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;image&quot;</span>
    <span class="s">&quot;image/color&quot;</span>
    <span class="s">&quot;image/gif&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;math&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="c1">//!-main</span>
<span class="c1">// Packages not needed by version in book.</span>
<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="c1">//!+main</span>

<span class="kd">var</span> <span class="nx">palette</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">color</span><span class="p">.</span><span class="nx">Color</span><span class="p">{</span><span class="nx">color</span><span class="p">.</span><span class="nx">White</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span><span class="p">}</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">whiteIndex</span> <span class="p">=</span> <span class="mi">0</span> <span class="c1">// first color in palette</span>
    <span class="nx">blackIndex</span> <span class="p">=</span> <span class="mi">1</span> <span class="c1">// next color in palette</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">lissajous</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">lissajous</span><span class="p">(</span><span class="nx">out</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">(</span>
        <span class="nx">cycles</span>  <span class="p">=</span> <span class="mi">5</span>     <span class="c1">// number of complete x oscillator revolutions</span>
        <span class="nx">res</span>     <span class="p">=</span> <span class="mf">0.001</span> <span class="c1">// angular resolution</span>
        <span class="nx">size</span>    <span class="p">=</span> <span class="mi">100</span>   <span class="c1">// image canvas covers [-size..+size]</span>
        <span class="nx">nframes</span> <span class="p">=</span> <span class="mi">64</span>    <span class="c1">// number of animation frames</span>
        <span class="nx">delay</span>   <span class="p">=</span> <span class="mi">8</span>     <span class="c1">// delay between frames in 10ms units</span>
    <span class="p">)</span>
    <span class="nx">freq</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Float64</span><span class="p">()</span> <span class="o">*</span> <span class="mf">3.0</span> <span class="c1">// relative frequency of y oscillator</span>
    <span class="nx">anim</span> <span class="o">:=</span> <span class="nx">gif</span><span class="p">.</span><span class="nx">GIF</span><span class="p">{</span><span class="nx">LoopCount</span><span class="p">:</span> <span class="nx">nframes</span><span class="p">}</span>
    <span class="nx">phase</span> <span class="o">:=</span> <span class="mf">0.0</span> <span class="c1">// phase difference</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">nframes</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">rect</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">size</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">NewPaletted</span><span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="nx">palette</span><span class="p">)</span>
        <span class="k">for</span> <span class="nx">t</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="nx">t</span> <span class="p">&lt;</span> <span class="nx">cycles</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span><span class="p">;</span> <span class="nx">t</span> <span class="o">+=</span> <span class="nx">res</span> <span class="p">{</span>
            <span class="nx">x</span> <span class="o">:=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Sin</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
            <span class="nx">y</span> <span class="o">:=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Sin</span><span class="p">(</span><span class="nx">t</span><span class="o">*</span><span class="nx">freq</span> <span class="o">+</span> <span class="nx">phase</span><span class="p">)</span>
            <span class="nx">img</span><span class="p">.</span><span class="nx">SetColorIndex</span><span class="p">(</span><span class="nx">size</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">size</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="nx">size</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="nx">y</span><span class="o">*</span><span class="nx">size</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="nx">blackIndex</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">phase</span> <span class="o">+=</span> <span class="mf">0.1</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">Delay</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">Delay</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span>
        <span class="nx">anim</span><span class="p">.</span><span class="nx">Image</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">anim</span><span class="p">.</span><span class="nx">Image</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">gif</span><span class="p">.</span><span class="nx">EncodeAll</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">anim</span><span class="p">)</span> <span class="c1">// NOTE: ignoring encoding errors</span>
<span class="p">}</span>
</pre></div>


<h4 id="package-names-with-multiple-components">Package names with multiple components *<a class="headerlink" href="#package-names-with-multiple-components" title="Permanent link">&para;</a></h4>
<p>After importing a package whose path has multiple components, we refer to the package with a name that comes from the last component. Therefore:</p>
<ul>
<li>The variable <code>color.White</code> belongs to the <code>image/color</code> package</li>
<li>The <a href="https://golang.org/pkg/image/gif/#GIF"><code>gif.GIF</code></a> belongs to the <code>image/gif</code> package</li>
</ul>
<h4 id="constant-declarations"><code>constant</code> declarations *<a class="headerlink" href="#constant-declarations" title="Permanent link">&para;</a></h4>
<p>A <code>const</code> declaration (<a href="../ch3/#constants">Section 3.6</a>) gives names to constants (values that are fixed at compile time) such as the numerical parameters for cycles, frames, and delay. Like <code>var</code> declarations, const declarations may appear at package level (so the names are visible throughout the package) or within a function (so the names are visible only within that function). <u>The value of a constant must be a number, string, or boolean.</u></p>
<h4 id="composite-literals">Composite literals *<a class="headerlink" href="#composite-literals" title="Permanent link">&para;</a></h4>
<p>The expressions <code>[]color.Color{...}</code> (a slice) and <code>gif.GIF{...}</code> (a struct) are <a href="https://golang.org/ref/spec#Composite_literals"><strong>composite literals</strong></a> (<a href="../ch4/#slices">Section 4.2</a>, <a href="../ch4/#struct-literals">Section 4.4.1</a>), a compact notation for instantiating any of Go’s composite types from a sequence of element values.</p>
<h4 id="structs">Structs *<a class="headerlink" href="#structs" title="Permanent link">&para;</a></h4>
<p>The type <code>gif.GIF</code> is a struct type (<a href="../ch4/#structs">Section 4.4</a>). A struct is a group of values called <em>fields</em>, often of different types, that are collected together in a single object that can be treated as a unit. The variable <code>anim</code> is a struct of type <code>gif.GIF</code>. The struct literal creates a struct value whose <code>LoopCount</code> field is set to <code>nframes</code>; all other fields have the zero value for their type. The individual fields of a struct can be accessed using dot notation, as in the final two assignments which explicitly update the <code>Delay</code> and <code>Image</code> fields of <code>anim</code>.</p>
<h4 id="the-lissajous-function">The <code>lissajous</code> function *<a class="headerlink" href="#the-lissajous-function" title="Permanent link">&para;</a></h4>
<p>[p15]</p>
<p>(skipped)</p>
<p>Used concepts:</p>
<ul>
<li>Built-in <code>append</code> function</li>
<li><code>io.Writer</code></li>
</ul>
<p>The <code>main</code> function calls the <code>lissajous</code> function, directing it to write to the standard output, so this command produces an animated GIF:</p>
<div class="codehilite"><pre><span class="gp">$</span> go build gopl.io/ch1/lissajous
<span class="gp">$</span> ./lissajous &gt;out.gif
</pre></div>


<h3 id="fetching-a-url">Fetching a URL<a class="headerlink" href="#fetching-a-url" title="Permanent link">&para;</a></h3>
<p>Go provides a collection of packages, grouped under <code>net</code>, that make it easy to send and receive information through the Internet, make low-level network connections, and set up servers, for which Go’s concurrency features (<a href="../ch8/">Chapter 8</a>) are particularly useful.</p>
<p>The following program fetches the content of each specified URL and prints it as uninterpreted text, which is inspired the <code>curl</code> utility:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/fetch/main.go">gopl.io/ch1/fetch/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Fetch prints the content found at a URL.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io/ioutil&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">url</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="s">&quot;fetch: %v\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">b</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
        <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="s">&quot;fetch: reading %s: %v\n&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>This program introduces functions from two packages, <code>net/http</code> and <code>io/ioutil</code>.</p>
<ol>
<li>The <code>http.Get</code> function makes an HTTP request and, if there is no error, returns the result in the response struct <code>resp</code>.</li>
<li>The <code>Body</code> field of <code>resp</code> contains the server response as a readable stream.</li>
<li><code>ioutil.ReadAll</code> reads the entire response; the result is stored in <code>b</code>.</li>
<li>The <code>Body</code> stream is closed to avoid leaking resources, and <code>Printf</code> writes the response to the standard output.</li>
</ol>
<div class="codehilite"><pre><span class="gp">$</span> go build gopl.io/ch1/fetch
<span class="gp">$</span> ./fetch http://gopl.io
<span class="go">&lt;html&gt;</span>
<span class="go">&lt;head&gt;</span>
<span class="go">&lt;title&gt;The Go Programming Language&lt;/title&gt;</span>
<span class="go">...</span>
</pre></div>


<p>If the HTTP request fails, <code>fetch</code> reports the failure instead:</p>
<div class="codehilite"><pre><span class="gp">$</span> ./fetch http://bad.gopl.io
<span class="go">fetch: Get http://bad.gopl.io: dial tcp: lookup bad.gopl.io: no such host</span>
</pre></div>


<h3 id="fetching-urls-concurrently">Fetching URLs Concurrently<a class="headerlink" href="#fetching-urls-concurrently" title="Permanent link">&para;</a></h3>
<p>Support for concurrent programming is one of the most interesting and novel aspects of Go. This is a large topic (concurrency mechanisms, goroutines and channels) to which Chapter 8 and Chapter 9 are devoted.</p>
<p>The following program, <code>fetchall</code>, does the same fetch of a URL’s contents as the previous example, but it fetches many URLs concurrently, so that the process will take no longer than the longest fetch rather than the sum of all the fetch times. This version of <code>fetchall</code> discards the responses but reports the size and elapsed time for each one:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/fetchall/main.go">gopl.io/ch1/fetchall/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Fetchall fetches URLs in parallel and reports their times and sizes.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;io/ioutil&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">ch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">url</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="k">go</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">ch</span><span class="p">)</span> <span class="c1">// start a goroutine</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="k">range</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">ch</span><span class="p">)</span> <span class="c1">// receive from channel ch</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%.2fs elapsed\n&quot;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nx">Seconds</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">ch</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprint</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="c1">// send to channel ch</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">nbytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">Discard</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">// don&#39;t leak resources</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;while reading %s: %v&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">secs</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nx">Seconds</span><span class="p">()</span>
    <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%.2fs  %7d  %s&quot;</span><span class="p">,</span> <span class="nx">secs</span><span class="p">,</span> <span class="nx">nbytes</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>Result:</p>
<div class="codehilite"><pre><span class="gp">$</span> go build gopl.io/ch1/fetchall
<span class="gp">$</span> ./fetchall https://golang.org http://gopl.io https://godoc.org
<span class="go">0.14s</span>
<span class="go">6852 https://godoc.org</span>
<span class="go">0.16s</span>
<span class="go">7261 https://golang.org</span>
<span class="go">0.48s</span>
<span class="go">2475 http://gopl.io</span>
<span class="go">0.48s elapsed</span>
</pre></div>


<ul>
<li>A <strong>goroutine</strong> is a concurrent function execution.</li>
<li>A <strong>channel</strong> is a communication mechanism that allows one goroutine to pass values of a specified type to another goroutine.<ul>
<li>The function <code>main</code> runs in a goroutine and the <code>go</code> statement creates additional goroutines.</li>
</ul>
</li>
</ul>
<p>This program does the following:</p>
<ol>
<li>The <code>main</code> function creates a channel of strings using <code>make</code>.</li>
<li>For each command-line argument, the <code>go</code> statement in the first range loop starts a new goroutine that calls <code>fetch</code> asynchronously to fetch the URL using <code>http.Get</code>.</li>
<li>The <a href="https://golang.org/pkg/io/#Copy"><code>io.Copy</code></a> function reads the body of the response and discards it by writing to the <a href="https://golang.org/pkg/io/ioutil/#Discard"><code>ioutil.Discard</code></a> output stream.</li>
<li><code>Copy</code> returns the byte count, along with any error that occurred. As each result arrives, <code>fetch</code> sends a summary line on the channel <code>ch</code>.</li>
<li>The second range loop in main receives and prints those lines.</li>
</ol>
<p>When one goroutine attempts a send or receive on a channel, it blocks until another goroutine attempts the corresponding receive or send operation, at which point the value is transferred and both goroutines proceed. In this example, each <code>fetch</code> sends a value (<code>ch &lt;-</code> <em>expression</em>) on the channel <code>ch</code>, and <code>main</code> receives all of them (<code>&lt;-ch</code>). <u>Having <code>main</code> do all the printing ensures that output from each goroutine is processed as a unit, with no danger of interleaving if two goroutines finish at the same time.</u></p>
<h3 id="a-web-server">A Web Server<a class="headerlink" href="#a-web-server" title="Permanent link">&para;</a></h3>
<p>Go’s libraries makes it easy to write a web server.</p>
<h4 id="echoing-url-path">Echoing URL path *<a class="headerlink" href="#echoing-url-path" title="Permanent link">&para;</a></h4>
<p>The following example shows a minimal server that returns the path component of the URL used to access the server. That is, if the request is for <code>http://localhost:8000/hello</code>, the response will be <code>URL.Path = "/hello"</code>.</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/server1/main.go">gopl.io/ch1/server1/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Server1 is a minimal &quot;echo&quot; server.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span> <span class="c1">// each request calls handler</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;localhost:8000&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// handler echoes the Path component of the request URL r.</span>
<span class="kd">func</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;URL.Path = %q\n&quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>This program does the following:</p>
<ol>
<li>The <code>main</code> function connects a handler function to incoming URLs that begin with <code>/</code> (which is all URLs) using <a href="https://golang.org/pkg/net/http/#HandleFunc"><code>http.HandleFunc</code></a>, and starts a server listening for incoming requests on port 8000 using <a href="https://golang.org/pkg/net/http/#ListenAndServe"><code>http.ListenAndServe</code></a>.</li>
<li>A request is represented as a struct of type <code>http.Request</code>, which contains a number of related fields, one of which is the URL of the incoming request.</li>
<li>When a request arrives, it is given to the <code>handler</code> function, which extracts the path component (<code>/hello</code>) from the request URL and sends it back as the response, using <code>fmt.Fprintf</code>. Web servers will be explained in detail in <a href="../ch7/#the-httphandler-interface">Section 7.7</a>.</li>
</ol>
<h4 id="request-counter">Request counter *<a class="headerlink" href="#request-counter" title="Permanent link">&para;</a></h4>
<p>This version does the same echo but also counts the number of requests; a request to the URL <code>/count</code> returns the count so far, excluding <code>/count</code> requests themselves:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/server2/main.go">gopl.io/ch1/server2/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// Server2 is a minimal &quot;echo&quot; and counter server.</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">mu</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<span class="kd">var</span> <span class="nx">count</span> <span class="kt">int</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/count&quot;</span><span class="p">,</span> <span class="nx">counter</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;localhost:8000&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// handler echoes the Path component of the requested URL.</span>
<span class="kd">func</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="nx">count</span><span class="o">++</span>
    <span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;URL.Path = %q\n&quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// counter echoes the number of calls so far.</span>
<span class="kd">func</span> <span class="nx">counter</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;Count %d\n&quot;</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
    <span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>


<p>The server has two handlers, and the request URL determines which one is called: a request for <code>/count</code> invokes <code>counter</code> and all others invoke <code>handler</code>. A handler pattern that ends with a slash matches any URL that has the pattern as a prefix.</p>
<p>Behind the scenes, the server runs the handler for each incoming request in a separate goroutine so that it can serve multiple requests simultaneously. We must ensure that at most one goroutine accesses the <code>count</code> variable at a time, which is the purpose of the <code>mu.Lock()</code> and <code>mu.Unlock()</code> calls that bracket each access of <code>count</code>. Otherwise, if two concurrent requests try to update count at the same time, it might not be incremented consistently; the program would have a serious bug called a race condition. Concurrency and shared variables are detailed in <a href="../ch9/">Chapter 9</a>.</p>
<h4 id="inspecting-requests">Inspecting requests *<a class="headerlink" href="#inspecting-requests" title="Permanent link">&para;</a></h4>
<p>In the following example, the <code>handler</code> function can report on the headers and form data that it receives, making the server useful for inspecting and debugging requests:</p>
<p><small><a href="https://github.com/shichao-an/gopl.io/blob/master/ch1/server3/main.go">gopl.io/ch1/server3/main.go</a></small></p>
<div class="codehilite"><pre><span class="c1">// handler echoes the HTTP request.</span>
<span class="kd">func</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;%s %s %s\n&quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Proto</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Header</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;Header[%q] = %q\n&quot;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;Host = %q\n&quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Host</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;RemoteAddr = %q\n&quot;</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">ParseForm</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Form</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&quot;Form[%q] = %q\n&quot;</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>[p21]</p>
<p>The call to <code>ParseForm</code> is nested within an <code>if</code> statement. Go allows a simple statement such as a local variable declaration to precede the <code>if</code> condition, which is particularly useful for error handling as in this example:</p>
<div class="codehilite"><pre><span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">ParseForm</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>This code could have been written it as:</p>
<div class="codehilite"><pre><span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">ParseForm</span><span class="p">()</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>but combining the statements is shorter and reduces the scope of the variable <code>err</code>, which is good practice. Scope is defined in <a href="../ch2/#section">Section 2.7</a>.</p>
<p>In these programs, three very different types are used as output streams:</p>
<ul>
<li>The <code>fetch</code> program copied HTTP response data to <code>os.Stdout</code>,</li>
<li>The <code>fetchall</code> program threw the response away by copying it to the trivial sink <code>ioutil.Discard</code>.</li>
<li>The web server above used <code>fmt.Fprintf</code> to write to an <code>http.ResponseWriter</code> representing the web browser.</li>
</ul>
<p>Although these three types differ in the details of what they do, they all satisfy a common
interface, allowing any of them to be used wherever an output stream is needed. That interface, called <code>io.Writer</code>, is discussed in <a href="../ch7/#interfaces-as-contracts">Section 7.1</a>.</p>
<p>Go’s interface mechanism is the topic of <a href="../ch7/">Chapter 7</a>. It's easy to combine the web server with the <code>lissajous</code> function so that animated GIFs are written not to the standard output, but to the HTTP client. Add the following code:</p>
<div class="codehilite"><pre><span class="nx">handler</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">lissajous</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
</pre></div>


<p>or equivalently:</p>
<div class="codehilite"><pre><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">lissajous</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>


<p>The second argument to the <code>HandleFunc</code> function call immediately above is a <a href="https://golang.org/ref/spec#Function_literals"><strong>function literal</strong></a>, which is an anonymous function defined at its point of use. This is detailed in <a href="#anonymous-functions">Section 5.6</a>.</p>
<h3 id="loose-ends">Loose Ends<a class="headerlink" href="#loose-ends" title="Permanent link">&para;</a></h3>
<p>The following are some topics that have been barely touched upon or omitted entirely.</p>
<h4 id="control-flow">Control flow<a class="headerlink" href="#control-flow" title="Permanent link">&para;</a></h4>
<h5 id="the-switch-statement"><strong>The <code>switch</code> statement</strong> *<a class="headerlink" href="#the-switch-statement" title="Permanent link">&para;</a></h5>
<p>Besides <code>if</code> and <code>for</code>, there is the <code>switch</code> statement, which is a multi-way branch. For example:</p>
<div class="codehilite"><pre><span class="k">switch</span> <span class="nx">coinflip</span><span class="p">()</span> <span class="p">{</span>
<span class="k">case</span> <span class="s">&quot;heads&quot;</span><span class="p">:</span>
    <span class="nx">heads</span><span class="o">++</span>
<span class="k">case</span> <span class="s">&quot;tails&quot;</span><span class="p">:</span>
    <span class="nx">tails</span><span class="o">++</span>
<span class="k">default</span><span class="p">:</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;landed on edge!&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>The result of calling <code>coinflip</code> is compared to the value of each case. Cases are evaluated from
top to bottom, so the first matching one is executed. <u>The optional default case matches if none
of the other cases does; it may be placed anywhere. Cases do not fall through from one to the
next as in C-like languages,</u> though there is a rarely used <a href="https://github.com/golang/go/wiki/Switch#fall-through"><code>fallthrough</code></a> statement that overrides this behavior.</p>
<p>A <code>switch</code> does not need an operand; it can just list the cases, each of which is a boolean expression:</p>
<div class="codehilite"><pre><span class="kd">func</span> <span class="nx">Signum</span><span class="p">(</span><span class="nx">x</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">x</span> <span class="p">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">case</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>This form is called a <em>tagless switch</em>; it’s equivalent to <code>switch true</code>.</p>
<p>Like the <code>for</code> and <code>if</code> statements, a <code>switch</code> may include an optional simple statement: a short variable declaration, an increment or assignment statement, or a function call, that can be used to set a value before it is tested.</p>
<h5 id="break-and-continue"><strong><code>break</code> and <code>continue</code></strong> *<a class="headerlink" href="#break-and-continue" title="Permanent link">&para;</a></h5>
<p>The <code>break</code> and continue <code>statements</code> modify the flow of control.</p>
<ul>
<li>A <code>break</code> causes control to resume at the next statement after the innermost <code>for</code>, <code>switch</code>, or <a href="https://golang.org/ref/spec#Select_statements"><code>select</code></a> statement</li>
<li>A <code>continue</code> causes the innermost for loop to start its next iteration.</li>
</ul>
<p>Statements <a href="https://golang.org/ref/spec#Continue_statements">may be labeled</a> so that <code>break</code> and <code>continue</code> can refer to them, for instance to break out of several nested loops at once or to start the next iteration of the outermost loop.</p>
<p>There is even a <code>goto</code> statement, though it’s intended for machine-generated code, not regular use by programmers.</p>
<h4 id="named-types">Named types<a class="headerlink" href="#named-types" title="Permanent link">&para;</a></h4>
<p>A <code>type</code> declaration gives a name to an existing type. <u>Since struct types are often long, they are nearly always named.</u> For example:</p>
<div class="codehilite"><pre><span class="kd">type</span> <span class="nx">Point</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="nx">Point</span>
</pre></div>


<p>Type declarations and named types are covered in <a href="../ch2/">Chapter 2</a>.</p>
<h4 id="pointers">Pointers<a class="headerlink" href="#pointers" title="Permanent link">&para;</a></h4>
<p>Pointers are values that contain the address of a variable.</p>
<ul>
<li>In some languages, notably C, pointers are relatively unconstrained.</li>
<li>In other languages, pointers are disguised as "references", and there’s not much that can be done with them except pass them around.</li>
<li>Go takes a position somewhere in the middle.<ul>
<li>Pointers are explicitly visible.</li>
<li>The <code>&amp;</code> operator yields the address of a variable.</li>
<li>The <code>*</code> operator retrieves the variable that the pointer refers to, but there is no pointer arithmetic.</li>
</ul>
</li>
</ul>
<p>Pointers are detailed in <a href="../ch2/#pointers">Section 2.3.2</a>.</p>
<h4 id="methods-and-interfaces">Methods and interfaces<a class="headerlink" href="#methods-and-interfaces" title="Permanent link">&para;</a></h4>
<p>A method is a function associated with a named type. In Go, methods may be attached to almost any named type. Methods are covered in <a href="../ch6/">Chapter 6</a>.</p>
<p>Interfaces are abstract types that let us treat different concrete types in the same way based on what methods they have, not how they are represented or implemented. Interfaces are the subject of <a href="../ch7/">Chapter 7</a>.</p>
<h4 id="packages">Packages<a class="headerlink" href="#packages" title="Permanent link">&para;</a></h4>
<p>Go has an extensive standard library of useful packages, and the Go community has created and shared many more. This book disucsses a couple of the most important standard packages.</p>
<p>Before you embark on any new program, it’s a good idea to see if packages already exist that might help you get your job done more easily. You can find an index of the standard library packages at <a href="https://golang.org/pkg">https://golang.org/pkg</a> and the packages contributed by the community at <a href="https://godoc.org">https://godoc.org</a>. The <code>go doc</code> tool makes these documents easily accessible from the command line:</p>
<div class="codehilite"><pre><span class="gp">$</span> go doc http.ListenAndServe
<span class="go">package http // import &quot;net/http&quot;</span>

<span class="go">func ListenAndServe(addr string, handler Handler) error</span>

<span class="go">  ListenAndServe listens on the TCP network address addr and then</span>
<span class="go">  calls Serve with handler to handle requests on incoming connections.</span>
<span class="go">...</span>
</pre></div>


<h4 id="comments">Comments<a class="headerlink" href="#comments" title="Permanent link">&para;</a></h4>
<p>Besides documentation comments at the beginning of a program or package, it’s also good style to write a comment before the declaration of each function to specify its behavior. These conventions are important, because they are used by tools like <code>go doc</code> and <code>godoc</code> to locate and display documentation.</p>
<p>For comments that span multiple lines or appear within an expression or statement, there is also the <code>/* ... */</code> notation familiar from other languages. Such comments are sometimes used at the beginning of a file for a large block of explanatory text to avoid a <code>//</code> on every line.  Within a comment, <code>//</code> and <code>/*</code> have no special meaning, so comments do not nest.</p>
            </div>
        </div>

        <footer class="col-md-12">
            
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../custom.js"></script>
    </body>
</html>