<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Global Site Tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-59055167-2"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-59055167-2');
        </script>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/per/ch6/">
        <link rel="shortcut icon" href="../../toki_32.png">
        

	<title>Chapter 6. Functions and Functional Programming - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,400italic,500,600" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">
        <link href="../../friendly.css" rel="stylesheet">
        <link href="../../theme.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../apue/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch3/">Chapter 3. File I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch4/">Chapter 4. Files and Directories</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch5/">Chapter 5. Standard I/O Library</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch6/">Chapter 6. System Data Files and Information</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch7/">Chapter 7. Process Environment</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch8/">Chapter 8. Process Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch9/">Chapter 9. Process Relationships</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch10/">Chapter 10. Signals</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch11/">Chapter 11. Threads</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch12/">Chapter 12. Thread Control</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch13/">Chapter 13. Daemon Processes</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch14/">Chapter 14. Advanced I/O</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch15/">Chapter 15. Interprocess Communication</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch16/">Chapter 16. Network IPC: Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../apue/ch17/">Chapter 17. Advanced IPC</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../unp/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch3/">Chapter 3. Sockets Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch4/">Chapter 4. Elementary TCP Sockets</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch5/">Chapter 5. TCP Client/Server Example</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch6/">Chapter 6. I/O Multiplexing: The select and poll Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch7/">Chapter 7. Socket Options</a>
                        </li>
                      
                        <li>
                            <a href="../../unp/ch8/">Chapter 8. Elementary UDP Sockets</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TCPv1 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../tcpv1/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch1/">Chapter 1. Introduction</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch2/">Chapter 2. The Internet Address Architecture</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch3/">Chapter 3. Link Layer</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch4/">Chapter 4. ARP: Address Resolution Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch5/">Chapter 5. The Internet Protocol (IP)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch6/">Chapter 6. System Configuration: DHCP and Autoconfiguration</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch7/">Chapter 7. Firewalls and Network Address Translation (NAT)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch8/">Chapter 8. ICMPv4 and ICMPv6: Internet Control Message Protocol</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch9/">Chapter 9. Broadcasting and Local Multicasting (IGMP and MLD)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch10/">Chapter 10. User Datagram Protocol (UDP) and IP Fragmentation</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch11/">Chapter 11. Name Resolution and the Domain Name System (DNS)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch12/">Chapter 12. TCP: The Transmission Control Protocol (Preliminaries)</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch13/">Chapter 13. TCP Connection Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch14/">Chapter 14. TCP Timeout and Retransmission</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch15/">Chapter 15. TCP Data Flow and Window Management</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch16/">Chapter 16. TCP Congestion Control</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch17/">Chapter 17. TCP Keepalive</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/ch18/">Chapter 18. Security: EAP, IPsec, TLS, DNSSEC, and DKIM</a>
                        </li>
                      
                        <li>
                            <a href="../../tcpv1/headers/">Headers</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">GOPL <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../gopl/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch1/">Chapter 1. Tutorial</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch2/">Chapter 2. Program Structure</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch3/">Chapter 3. Basic Data Types</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch4/">Chapter 4. Composite Types</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch5/">Chapter 5. Functions</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch6/">Chapter 6. Methods</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch7/">Chapter 7. Interfaces</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch8/">Chapter 8. Goroutines and Channels</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch9/">Chapter 9. Concurrency with Shared Variables</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch10/">Chapter 10. Packages and the Go Tool</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch11/">Chapter 11. Testing</a>
                        </li>
                      
                        <li>
                            <a href="../../gopl/ch12/">Chapter 12. Reflection</a>
                        </li>
                      
                    </ul>
                </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CSN <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li>
                            <a href="../../csn/">Contents</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part1/">Part 1: Language</a>
                        </li>
                      
                        <li>
                            <a href="../../csn/part2/">Part 2: Advanced</a>
                        </li>
                      
                    </ul>
                </li>
            <li>
                    <a href="../../toc/">TOC</a>
                </li>
            </ul>
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    
                        <a href="https://github.com/shichao-an/notes/blob/master/docs/per/ch6.md">
                    
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-6-functions-and-functional-programming">Chapter 6. Functions and Functional Programming</a></li>
        
    
        <li class="main "><a href="#functions">Functions</a></li>
        
    
        <li class="main "><a href="#parameter-passing-and-return-values">Parameter Passing and Return Values</a></li>
        
    
        <li class="main "><a href="#scoping-rules">Scoping Rules</a></li>
        
    
        <li class="main "><a href="#functions-as-objects-and-closures">Functions as Objects and Closures</a></li>
        
    
        <li class="main "><a href="#decorators">Decorators</a></li>
        
            <li><a href="#order-of-multiple-decorators">Order of multiple decorators *</a></li>
        
            <li><a href="#decorators-with-arguments">Decorators with arguments *</a></li>
        
    
        <li class="main "><a href="#generators-and-yield">Generators and yield</a></li>
        
            <li><a href="#the-close-method-and-generatorexit-exception">The close() method and GeneratorExit exception *</a></li>
        
    
        <li class="main "><a href="#coroutines-and-yield-expressions">Coroutines and yield Expressions</a></li>
        
            <li><a href="#raise-exceptions-throw-method">Raise exceptions throw() method *</a></li>
        
            <li><a href="#simultaneously-receive-and-emit-return-values">Simultaneously receive and emit return values *</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">
              

<h3 id="chapter-6-functions-and-functional-programming"><strong>Chapter 6. Functions and Functional Programming</strong><a class="headerlink" href="#chapter-6-functions-and-functional-programming" title="Permanent link">&para;</a></h3>
<h3 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h3>
<h3 id="parameter-passing-and-return-values">Parameter Passing and Return Values<a class="headerlink" href="#parameter-passing-and-return-values" title="Permanent link">&para;</a></h3>
<h3 id="scoping-rules">Scoping Rules<a class="headerlink" href="#scoping-rules" title="Permanent link">&para;</a></h3>
<h3 id="functions-as-objects-and-closures">Functions as Objects and Closures<a class="headerlink" href="#functions-as-objects-and-closures" title="Permanent link">&para;</a></h3>
<h3 id="decorators">Decorators<a class="headerlink" href="#decorators" title="Permanent link">&para;</a></h3>
<p>A <strong>decorator</strong> is a function whose primary purpose is to wrap another function or class.  The primary purpose of this wrapping is to transparently alter or enhance the behavior of the object being wrapped. Syntactically, decorators are denoted using the special <code>@</code> symbol as follows:</p>
<div class="codehilite"><pre><span class="nd">@trace</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
</pre></div>


<p>The preceding code is shorthand for the following:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
<span class="n">square</span> <span class="o">=</span> <span class="n">trace</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
</pre></div>


<p>In the example, a function <code>square()</code> is defined. However, immediately after its definition, the function object itself is passed to the function <code>trace()</code>, which returns an object that replaces the original <code>square</code>.</p>
<p>[p101]</p>
<h5 id="order-of-multiple-decorators"><strong>Order of multiple decorators</strong> *<a class="headerlink" href="#order-of-multiple-decorators" title="Permanent link">&para;</a></h5>
<p>When decorators are used, they must appear on their own line immediately prior to a function or class definition. More than one decorator can also be applied. For example:</p>
<div class="codehilite"><pre><span class="nd">@foo</span>
<span class="nd">@bar</span>
<span class="nd">@spam</span>
<span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>


<p>In this case, the decorators are applied in the order listed.The result is the same as this:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">grok</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">bar</span><span class="p">(</span><span class="n">spam</span><span class="p">(</span><span class="n">grok</span><span class="p">)))</span>
</pre></div>


<h5 id="decorators-with-arguments"><strong>Decorators with arguments</strong> *<a class="headerlink" href="#decorators-with-arguments" title="Permanent link">&para;</a></h5>
<p>A decorator can also accept arguments. For example:</p>
<div class="codehilite"><pre><span class="nd">@eventhandler</span><span class="p">(</span><span class="s1">&#39;BUTTON&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_button</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="c1"># ...</span>
<span class="nd">@eventhandler</span><span class="p">(</span><span class="s1">&#39;RESET&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_reset</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="c1"># ...</span>
</pre></div>


<p>If arguments are supplied, the semantics of the decorator are as follows:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">handle_button</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="c1"># ...</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">eventhandler</span><span class="p">(</span><span class="s1">&#39;BUTTON&#39;</span><span class="p">)</span> <span class="c1"># Call decorator with supplied arguments</span>
<span class="n">handle_button</span> <span class="o">=</span> <span class="n">temp</span><span class="p">(</span><span class="n">handle_button</span><span class="p">)</span> <span class="c1"># Call the function returned by the decorato</span>
</pre></div>


<p>In this case, the decorator function only accepts the arguments supplied with the <code>@</code> specifier. It then returns a function that is called with the function as an argument.</p>
<div class="codehilite"><pre><span class="c1"># Event handler decorator</span>
<span class="n">event_handlers</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">def</span> <span class="nf">eventhandler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">event_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">register_function</span>
</pre></div>


<p>Decorators can also be applied to class definitions. For example:</p>
<div class="codehilite"><pre><span class="nd">@foo</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># statements</span>
</pre></div>


<p>For class decorators, you should always have the decorator function return a class object as a result. Code that expects to work with the original class definition may want to reference members of the class directly such as <code>Bar.spam</code>. This won’t work correctly if the decorator function <code>foo()</code> returns a function.</p>
<p>Decorators can interact strangely with other aspects of functions such as recursion, documentation strings, and function attributes. These issues are described later in this chapter.</p>
<h3 id="generators-and-yield">Generators and yield<a class="headerlink" href="#generators-and-yield" title="Permanent link">&para;</a></h3>
<p>If a function uses the <code>yield</code> keyword, it defines an object known as a <strong>generator</strong>. A generator is a function that produces a sequence of values for use in iteration. For example:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Counting down from </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span>
</pre></div>


<p>When this function is called, its code does not start executing. For example:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>


<p>Instead, a generator object is returned, which executes the function whenever <code>next()</code> is called (or <code>__next_ _()</code> in Python 3). For example:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c1"># Use c.__next__() in Python 3</span>
<span class="go">Counting down from 10</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">9</span>
</pre></div>


<p>When <code>next()</code> is invoked, the generator function executes statements until it reaches a <code>yield</code> statement. The <code>yield</code> statement produces a result at which point execution of the function stops until <code>next()</code> is invoked again. Execution then resumes with the statement following <code>yield</code>.</p>
<p>You normally don’t call <code>next()</code> directly on a generator but use it with the for statement, <code>sum()</code>, or some other operation that consumes a sequence.</p>
<h4 id="the-close-method-and-generatorexit-exception">The <code>close()</code> method and <code>GeneratorExit</code> exception *<a class="headerlink" href="#the-close-method-and-generatorexit-exception" title="Permanent link">&para;</a></h4>
<p>A problem with generators is the case where a generator function is
only partially consumed. For example:</p>
<div class="codehilite"><pre><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>


<p>Since the <code>for</code> loop aborts by calling <code>break</code>, the associated generator never runs to full completion. To handle this case, generator objects have a method <code>close()</code> that is used to signal a shutdown. When a generator is no longer used or deleted, close() is called.</p>
<p>Though it normally not necessary to call <code>close()</code>, you can also call it manually as shown here:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">countdown</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">Counting down from 10</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="err">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">StopIteration</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>


<p>Inside the generator function, <code>close()</code> is signaled by a <code>GeneratorExit</code> exception occurring on the <code>yield</code> statement. You can optionally catch this exception to perform cleanup actions.</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Counting down from </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">n</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Only made it to </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
</pre></div>


<p>Note that:</p>
<ul>
<li>Although it is possible to catch <code>GeneratorExit</code>, it is illegal for a generator function to handle the exception and produce another output value using yield.</li>
<li>If a program is currently iterating on generator, you should not call <code>close()</code> asynchronously on that generator from a separate thread of execution or from a signal handler.</li>
</ul>
<h3 id="coroutines-and-yield-expressions">Coroutines and yield Expressions<a class="headerlink" href="#coroutines-and-yield-expressions" title="Permanent link">&para;</a></h3>
<p>Inside a function, the <code>yield</code> statement can also be used as an expression that appears on the right side of an assignment operator. For example:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">receiver</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Ready to receive&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
</pre></div>


<p><u>A function that uses <code>yield</code> in this manner is known as a <strong>coroutine</strong>, and it executes in response to values being sent to it.</u> Its behavior is also very similar to a generator. For example:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="c1"># Advance to first yield (r._ _next_ _() in Python 3)</span>
<span class="go">Ready to receive</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">Got 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">Got 2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="go">Got Hello</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>


<p>In this example:</p>
<ol>
<li>After the call to <code>next()</code>, the coroutine executes statements leading to the first <code>yield</code> expression. At this point, the coroutine suspends, waiting for a value to be sent to it using the <code>send()</code> method of the associated generator object <code>r</code>.</li>
<li>The value passed to <code>send()</code> is returned by the <code>(yield)</code> expression in the coroutine. Upon receiving a value, a coroutine executes statements until the next <code>yield</code> statement is encountered.</li>
</ol>
<p>To avoid overlooking <code>next()</code> on a coroutine to be called, it is recommended that coroutines be wrapped with a decorator that automatically takes care of this step.</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">coroutine</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">g</span>
    <span class="k">return</span> <span class="n">start</span>
</pre></div>


<p>Using this decorator, you would write and use coroutines using:</p>
<div class="codehilite"><pre><span class="nd">@coroutine</span>
<span class="k">def</span> <span class="nf">receiver</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Ready to receive&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
<span class="c1"># Example use</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span> <span class="c1"># Note : No initial .next() needed</span>
</pre></div>


<p>A coroutine will typically run indefinitely unless:</p>
<ul>
<li>It is explicitly shut down (by calling <code>close()</code>).</li>
<li>It exits on its own.</li>
</ul>
<p>The <code>close()</code> method closes the stream of input values:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">StopIteration</span>
</pre></div>


<p>Once closed, a <code>StopIteration</code> exception will be raised if further values are sent to a coroutine. The <code>close()</code> operation raises <code>GeneratorExit</code> (which can be caught using <code>except</code>) inside the coroutine.</p>
<h4 id="raise-exceptions-throw-method">Raise exceptions <code>throw()</code> method *<a class="headerlink" href="#raise-exceptions-throw-method" title="Permanent link">&para;</a></h4>
<p>Exceptions can be raised inside a coroutine using the <code>throw(exctype [, value [, tb]])</code> method where <code>exctype</code> is an exception type, <code>value</code> is the exception value, and <code>tb</code> is a traceback object. For example:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">throw</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="s2">&quot;You&#39;re hosed!&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="err">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">File &quot;&lt;stdin&gt;&quot;, line 4, in receiver</span>
<span class="go">RuntimeError: You&#39;re hosed!</span>
</pre></div>


<ul>
<li>Exceptions raised using <code>throw()</code> will originate at the currently executing <code>yield</code> statement in the coroutine. A coroutine is able to catch exceptions and handle them as appropriate.</li>
<li>It is not safe to use <code>throw()</code> as an asynchronous signal to a coroutine; it should never be invoked from a separate execution thread or in a signal handler.</li>
</ul>
<h4 id="simultaneously-receive-and-emit-return-values">Simultaneously receive and emit return values *<a class="headerlink" href="#simultaneously-receive-and-emit-return-values" title="Permanent link">&para;</a></h4>
<p>A coroutine may simultaneously receive and emit return values using <code>yield</code> if values are supplied in the <code>yield</code> expression. For example:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">line_splitter</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Ready to split&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
</pre></div>


<p>Now calls to <code>send()</code> also produce a result. For example:</p>
<div class="codehilite"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">line_splitter</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">Ready to split</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;A,B,C&quot;</span><span class="p">)</span>
<span class="go">[&#39;A&#39;, &#39;B&#39;, &#39;C&#39; ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;100,200,300&quot;</span><span class="p">)</span>
<span class="go">[&#39;100&#39;, &#39;200&#39;, &#39;300&#39;]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>


<ol>
<li>The first <code>next()</code> call advances the coroutine to <code>(yield result)</code>, which returns <code>None</code>, the initial value of <code>result</code>.</li>
<li>On subsequent <code>send()</code> calls, the received value is placed in <code>line</code> and split into <code>result</code>. The value returned by <code>send()</code> is the value passed to the next <code>yield</code> statement encountered. In other words, <u>the value returned by <code>send()</code> comes from the next <code>yield</code> expression, not the one responsible for receiving the value passed by <code>send()</code>.</u></li>
</ol>
<p>If a coroutine returns values, some care is required if exceptions raised with <code>throw()</code> are being handled. <u>If you raise an exception in a coroutine using <code>throw()</code>, the value passed to the next <code>yield</code> in the coroutine will be returned as the result of <code>throw()</code>. If you need this value and forget to save it, it will be lost.</u></p>
            </div>
        </div>

        <footer class="col-md-12">
            
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../custom.js"></script>
    </body>
</html>